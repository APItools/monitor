(function(){var slug;window.history.pushState(null,null,window.location.pathname),moment.lang("en",{"relativeTime":{"future":"in %s","past":function(output){return"a few seconds"===output?"just now":""+output+" ago"},"s":"a few seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"longDateFormat":{"LT":"h:mm A UTC","L":"MM/DD/YYYY","LL":"MMMM Do YYYY","LLL":"MMMM Do YYYY LT","LLLL":"dddd, MMMM Do YYYY LT"}}),slug=angular.module("slug",["slug.controllers","slug.services","slug.filters","slug.directives","angular-flash.flash-alert-directive","ui.router","ui.bootstrap.tooltip","ui.bootstrap.popover","ui.bootstrap.typeahead","slug.analytics","slug.dashboard","slug.dashboards","slug.service","slug.active_docs","slug.home","slug.root","slug.documentation"]),slug.run(function($rootScope,$state){return $rootScope.$state=$state}),slug.config(function($provide){return $provide.decorator("$exceptionHandler",function($delegate,errorception){return function(exception,cause){return $delegate(exception,cause),errorception(exception)}})}),slug.config(function($stateProvider,$locationProvider,$anchorScrollProvider){return $locationProvider.html5Mode(!0).hashPrefix("!"),$anchorScrollProvider.disableAutoScrolling(),$stateProvider.state("search",{"url":"/search","templateUrl":"/search/index.html","controller":"SearchCtrl"}).state("service.traces",{"parent":"service","url":"/traces?filter","templateUrl":"/services/traces/index.html","controller":"ServiceTracesIndexCtrl"}).state("traces",{"url":"/traces?filter","templateUrl":"/traces/index.html","controller":"TracesIndexCtrl"}).state("trace",{"url":"/traces/:traceId","templateUrl":"/traces/show.html","controller":"TraceShowCtrl"})})}).call(this),function(){angular.module("slug.controllers",["angular-flash.service","ui.bootstrap.accordion","ui.bootstrap.tabs","ui.bootstrap.tooltip","angularMoment","ui.router","ui.bootstrap.modal","slug.middlewares","slug.middleware_specs","slug.traces","slug.notifications","slug.controllers.services","slug.user_settings","slug.services.brain"])}.call(this),function(){angular.module("slug.active_docs",["slug.service"]).config(function($stateProvider){return $stateProvider.state("service.docs",{"parent":"service","url":"/docs","templateUrl":"/active_docs/index.html","controller":"ActiveDocsCtrl"}).state("service.docs.operation",{"parent":"service.docs","url":"/:operationGuid","controller":"ActiveDocsOperationCtrl","templateUrl":"/active_docs/index.html"})}).factory("ActiveDocsOperation",function($http,$state){return function(request,service_id){var params;return null==service_id&&(service_id=$state.params.serviceId),params={"method":request.method,"path":request.uri},$http({"method":"GET","url":"/api/services/"+service_id+"/operation","params":params})}}).controller("ActiveDocsCtrl",function($scope,service){return $scope.resource={"name":service.name,"system_name":service.code(),"path":"/api/services/"+service._id+"/docs","domain":service.host()}}).directive("preventDocsLoad",function($window){return{"compile":function(element,attrs){var hasDocs,replacement,src,_ref;return src=attrs.preventDocsLoad,hasDocs=null!=(null!=(_ref=$window.ThreeScale)?_ref.APIDocs:void 0),hasDocs?void 0:(replacement=angular.element("<script/>").attr({"src":src}),element.replaceWith(replacement))}}}).directive("activeDocs",function($state,$window){var HEADING_CLASS,LOADED_EVENT;return LOADED_EVENT="resources:loaded",HEADING_CLASS=".apidocs-heading",{"scope":{"resources":"=activeDocs"},"link":function(scope,element){var APIDocs;return element.addClass("api-docs-wrap"),element.on("click",HEADING_CLASS,function(){var content,heading,params;return heading=angular.element(event.target).closest(HEADING_CLASS),content=heading.siblings(".content"),content.is(":visible")?void 0:(params={"operationGuid":content.data("operation-id")},$state.go("service.docs.operation",params))}),APIDocs=ThreeScale.APIDocs,APIDocs.account_type="provider",APIDocs.init(scope.resources),APIDocs.jQuery.subscribe(LOADED_EVENT,function(){var operation;return operation=element.find("[data-operation-id='"+$state.params.operationGuid+"']"),APIDocs.Docs.expandOperation(operation,function(){var win;return win=angular.element($window),win.scrollTop(operation.position().top)})}),scope.$on("$destroy",function(){return APIDocs.jQuery.unsubscribe(LOADED_EVENT)})}}}).directive("docsLink",function($state,ActiveDocsOperation,flash){return{"restrict":"A","priority":-1,"scope":{"trace":"=docsLink"},"link":function(scope,element){var afterResolvingTrace,trace;return trace=scope.trace,afterResolvingTrace=function(trace){var changeState,operation,reportFail,service_id;return service_id=trace.service_id,operation=null,changeState=function(res){return $state.go("service.docs.operation",{"serviceId":service_id,"operationGuid":res.data.guid})},reportFail=function(err){return flash.error=err.data.error},element.on("mouseenter",function(){return operation||(operation=ActiveDocsOperation(trace.req,service_id))}),element.on("click",function(){return operation.then(changeState,reportFail),!1})},trace.$promise?trace.$promise.then(afterResolvingTrace):afterResolvingTrace(trace)}}})}.call(this),function(){angular.module("slug.controllers").factory("System",function($http){return{"initialize":function(){return $http.post("/api/system/initialize")},"reset":function(){return $http.post("/api/system/reset")}}}).controller("AppController",function($scope,Service,System,Brain){return System.initialize(),$scope.brain=Brain})}.call(this),function(){var __bind=function(fn,me){return function(){return fn.apply(me,arguments)}};angular.module("slug.dashboard",["ui.router","slug.stats","slug.notifications","slug.service","slug.traces.services"]).config(function($stateProvider){return $stateProvider.state("dashboard",{"url":"/dashboard","templateUrl":"/dashboard/show.html","controller":"DashboardCtrl"})}).factory("AggregatedDashboard",function($http,LoadChart,$timeout,$q,Stats){var AggeragedDashboard;return AggeragedDashboard=function(){function AggeragedDashboard(){this.stop=__bind(this.stop,this),this.hook=__bind(this.hook,this),this.load("traffic")}return AggeragedDashboard.traffic={"title":"All Traffic","projections":{"count":!0},"metric":"hits","range":{"granularity":60,"type":"relative","relative":{"end":"now","start":3600}}},AggeragedDashboard.time={"title":"Response Time","projections":{"avg":!0},"metric":"time","range":{"granularity":60,"type":"relative","relative":{"end":"now","start":3600}}},AggeragedDashboard.errors={"title":"Errors","projections":{"avg":!0,"count":!0},"metric":"status","statuses":{"$gte":400,"$lt":600},"range":{"granularity":60,"type":"relative","relative":{"end":"now","start":3600}}},AggeragedDashboard.prototype.available={"errors":AggeragedDashboard.errors,"traffic":AggeragedDashboard.traffic,"time":AggeragedDashboard.time},AggeragedDashboard.prototype["default"]="traffic",AggeragedDashboard.prototype.colors={"errors":"#AC3131","time":"#FFA500","traffic":"#317eac"},AggeragedDashboard.prototype.hook=function($scope){return $scope.$on("$destroy",this.stop)},AggeragedDashboard.prototype.stop=function(){return $timeout.cancel(this.last_timeout)},AggeragedDashboard.prototype.autoupdate=function(dashboard,callback){var update_stats;return this.stop(),(update_stats=function(_this){return function(){return _this.load(dashboard,callback).then(function(){return _this.last_timeout=$timeout(update_stats,6e4)})}}(this))()},AggeragedDashboard.prototype.load=function(what,callback){return LoadChart({"query":AggeragedDashboard[what]},Stats).then(function(_this){return function(stats){return _this[what]=stats}}(this)).then(callback)},AggeragedDashboard}()}).controller("DashboardCtrl",function($scope,$rootScope,AggregatedDashboard,Service,Event,Trace,jsonify){var last_events_query,last_hour,last_stats_query;return $rootScope.$emit("serviceReset"),$scope.dashboards=new AggregatedDashboard,$scope.dashboards.hook($scope),last_hour=function(conditions){var timeframe,timestamp;return timestamp=moment().subtract("hour",1).unix(),timeframe={"_created_at":{"$gte":timestamp}},angular.extend(timeframe,conditions||{}),jsonify(timeframe)},$scope.middleware_errors=Event.count({"query":last_hour({"level":"error"})}),$scope.request_errors=Trace.count({"query":last_hour({"res":{"status":{"$gte":400}}})}),$scope.services=Service.query(),$scope.selectDashboard=function(key){return $scope.selected_dashboard=key,$scope.color=$scope.dashboards.colors[key],$scope.dashboards.autoupdate(key,function(dashboard){return $scope.dashboard=dashboard})},$scope.selectDashboard($scope.dashboards["default"]),last_events_query=jsonify({"level":{"$in":["error","alert","warn","info"]}}),$scope.last_notifications=Event.query({"query":last_events_query,"reversed":!0,"per_page":7}),$scope.last_traces=Trace.query({"reversed":!0,"per_page":7}),last_stats_query=jsonify({"channel":"stats"}),$scope.last_stats=Event.count({"query":last_stats_query})})}.call(this),function(){angular.module("slug.dashboards",["ngResource","slug.service","slug.stats"]).config(function($stateProvider){return $stateProvider.state("service.analytics",{"parent":"service","url":"/analytics","templateUrl":"/analytics/index.html","controller":"DashboardsCtrl"})}).factory("Dashboard",function($resource,$state){return $resource("/api/services/:serviceId/dashboards/:id/",{"id":"@_id","serviceId":function(){return $state.params.serviceId}})}).factory("Metrics",function($resource){return $resource("/api/stats/metrics")}).controller("DashboardsCtrl",function($scope,Dashboard){return $scope.dashboards=Dashboard.query(),$scope.select=function(dashboard){return $scope.current_dashboard=dashboard}}).controller("ChartController",function($scope,LoadChart,$timeout){var last_timeout,update;return $scope.blueprint=$scope.window.blueprint,$scope.chart=$scope.window.chart,last_timeout=null,$scope.$on("$destroy",function(){return $timeout.cancel(last_timeout)}),(update=function(){var chart;return chart=$scope.chart,LoadChart(chart).then(function(stats){var granularity;return $scope.stats=stats,granularity=chart.query.range.granularity,last_timeout=$timeout(update,1e3*granularity)})})()}).controller("CurrentDashboardCtrl",function($scope,$modal,flash){var charts;return $scope.blueprint={"type":"normal","charts":[{"type":"expanded"},{"type":"normal"},{"type":"normal"}]},charts=function(){return $scope.current_dashboard.charts},$scope.$watch(charts,function(dashboard_charts){var blueprint,index;return $scope.windows=function(){var _i,_len,_ref,_results;for(_ref=$scope.blueprint.charts,_results=[],index=_i=0,_len=_ref.length;_len>_i;index=++_i)blueprint=_ref[index],_results.push({"blueprint":blueprint,"chart":null!=dashboard_charts?dashboard_charts[index]:void 0});return _results}()}),$scope.editChartDialog=function(chart,callback){var dialog;return dialog=$modal.open({"backdrop":!0,"keyboard":!0,"windowClass":"modal modal-slug chart-edit modal-tall","backdropClick":!1,"templateUrl":"/dashboards/chart.html","controller":"DashboardEditChartDialogCtrl","resolve":{"chart":function(){return angular.copy(chart)}}}),dialog.result.then(function(result){return(result||_.isNull(result))&&"function"==typeof callback?callback(result):void 0})},$scope.saveDashboard=function(){return $scope.current_dashboard.$save(function(){return flash.success="Dashboard saved"})},$scope.addChart=function(position,chart){var dashboard,newChart;return dashboard=$scope.current_dashboard,charts=dashboard.charts,_.isEmpty(charts)&&(charts=dashboard.charts=[]),newChart={"position":position,"plot":chart,"$new":!0,"name":"New Chart"},$scope.editChartDialog(newChart,function(chart){return dashboard.charts[position]=chart,delete chart.$new,$scope.saveDashboard()})},$scope.editChart=function(chart){var dashboard;return dashboard=$scope.current_dashboard,charts=dashboard.charts,$scope.editChartDialog(chart,function(updated){var index;return index=charts.indexOf(chart),charts[index]=updated,$scope.saveDashboard()})}}).controller("DashboardEditChartDialogCtrl",function($scope,chart,Metrics,LoadChart){var default_query,hr;return $scope.save=function(){return $scope.$close(chart)},$scope.close=function(){return $scope.$close(!1)},$scope["delete"]=function(){return $scope.$close(null)},default_query={"projections":{"avg":!0,"count":!0},"paths":[],"methods":{},"statuses":[],"metric":"time","range":{"granularity":60,"type":"relative","absolute":{"start":moment().subtract(1,"day").unix(),"end":moment().unix()},"relative":{"end":"now","start":3600}},"group_by":{}},$scope.chart=chart,$scope.query=chart.query=angular.extend({},default_query,chart.query),$scope.absolute={"start":moment()},$scope.relative={"end":"now","start":3600},$scope.startDate=function(seconds){return moment().subtract(seconds,"seconds").toDate()},$scope.preview=function(){return LoadChart(chart).then(function(template){return $scope.analytics=template})},$scope.preview(),hr=3600,$scope.available={"ranges":[{"length":1800,"label":"30 min","title":"30 minutes"},{"length":3600,"label":"60 min","title":"1 hour"},{"length":3*hr,"label":"3 hr","title":"3 hours"},{"length":6*hr,"label":"6 hr","title":"6 hours"},{"length":12*hr,"label":"12 hr","title":"1/2 day"},{"length":24*hr,"label":"24 hr","title":"1 day"},{"length":168*hr,"label":"1 wk","title":"1 week"}],"granularities":[{"granularity":10,"label":"10 sec","tooltip":"10 seconds increments"},{"granularity":60,"label":"1 min","tooltip":"1 minute increments"},{"granularity":3600,"label":"1 hr","tooltip":"1 hour increments"},{"granularity":86400,"label":"1 day","tooltip":"1 day increments"}],"metrics":Metrics.query()},$scope.available.metrics.$promise.then(function(metrics){return $scope.metrics=_(metrics).indexBy("key")})}).controller("DashboardsNavigationCtrl",function($scope,Dashboard,flash){var charts,original_select;return $scope.helpTemplate="analytics",charts={"statuses":{"plot":{"type":"big"},"position":0,"name":"Statuses","query":{"methods":[],"paths":[],"statuses":[],"group_by":{"statuses":!0},"metric":"status","projections":{"count":!0},"range":{"type":"relative","granularity":60,"relative":{"end":"now","start":1800}}}},"traffic":{"plot":{"type":"small"},"position":1,"name":"Traffic","query":{"methods":[],"paths":[],"statuses":[],"group_by":{"paths":!0,"methods":!0},"metric":"hits","projections":{"count":!0},"range":{"type":"relative","granularity":60,"relative":{"end":"now","start":1800}}}},"methods":{"plot":{"type":"small"},"position":2,"name":"Methods average time","query":{"methods":[],"paths":[],"statuses":[],"group_by":{"methods":!0},"metric":"time","projections":{"avg":!0},"range":{"type":"relative","granularity":60,"relative":{"end":"now","start":1800}}}}},$scope.dashboards.$promise.then(function(dashboards){var dashboard,defaults;return dashboard=dashboards[0],dashboard||(defaults=[charts.statuses,charts.traffic,charts.methods],dashboard=$scope.emptyDashboard({"name":"default dashboard","charts":defaults}),dashboard.$save(function(){return dashboards.push(dashboard)})),$scope.select(dashboard)}),$scope.emptyDashboard=function(attributes){return new Dashboard(attributes)},$scope.addEmptyDashboard=function(attributes){var dashboard;if($scope.canAbortEdit())return dashboard=$scope.emptyDashboard(attributes),$scope.dashboards.push(dashboard),$scope.edit(dashboard)},original_select=$scope.select,$scope.select=function(dashboard){return $scope.abort(),original_select(dashboard)},$scope.edit=function(dashboard){return $scope.editing=angular.copy(dashboard),$scope.editing.$original=dashboard},$scope.isEditing=function(dashboard){var _ref;return(null!=(_ref=$scope.editing)?_ref.$original:void 0)===dashboard},$scope["delete"]=function(dashboard){return dashboard.$delete(function(){return $scope.remove(dashboard),flash.success="Dashboard "+dashboard.name+" removed",$scope.abort()})},$scope.canAbortEdit=function(){var original,_ref;return original=null!=(_ref=$scope.editing)?_ref.$original:void 0,original?null!=original._id:!0},$scope.remove=function(dashboard){return $scope.dashboards=_($scope.dashboards).without(dashboard)},$scope.save=function(dashboard){return angular.extend(dashboard,$scope.editing),dashboard.$save(function(){return $scope.abort(),$scope.select(dashboard),flash.success="Dashboard "+dashboard.name+" saved"})},$scope.abort=function(){var _ref;return $scope.canAbortEdit()||$scope.remove(null!=(_ref=$scope.editing)?_ref.$original:void 0),$scope.editing=null}}).factory("UsedMethods",function($resource,$state){return $resource("/api/services/:service_id/used_methods",{"service_id":function(){return $state.params.serviceId}})}).factory("AutoCompletePaths",function($resource,$state){return $resource("/api/services/:service_id/path_autocomplete",{"service_id":function(){return $state.params.serviceId}})}).controller("ChartConditionsCtrl",function($scope,UsedMethods,AutoCompletePaths){return $scope.$watch("query",function(query){var metric,_i,_len,_ref,_results;for(_ref=["statuses","paths"],_results=[],_i=0,_len=_ref.length;_len>_i;_i++)metric=_ref[_i],_results.push(_.isArray(null!=query?query[metric]:void 0)?void 0:query[metric]=[]);return _results}),$scope.randomMethod=function(method){return method.$placeholder||(method.$placeholder=_.shuffle(["GET","POST","PUT","PATH","DELETE"])[0])},$scope.randomStatus=function(status){return status.$placeholder||(status.$placeholder=_.shuffle([200,201,301,302,404,500])[0])},$scope.getAutocompletePaths=AutoCompletePaths.query(),$scope.isMethodChecked=function(method){return $scope.query.methods[method]},$scope.noMethodsAreChecked=function(){var anyChecked;return anyChecked=_($scope.query.methods).find(function(v){return v===!0}),!anyChecked},$scope.used_methods=UsedMethods.get(function(methods_resource){var method,_i,_len,_ref,_results;for(_ref=methods_resource.methods,_results=[],_i=0,_len=_ref.length;_len>_i;_i++)method=_ref[_i],_results.push($scope.query.methods[method]=!0);return _results}),$scope.add=function(collection){return collection.push({})},$scope.remove=function(collection,element){var index;return index=collection.indexOf(element),collection.splice(index,1)}}).controller("ChartProjectionsCtrl",function($scope){return $scope.$watch("query.metric",function(metric){return $scope.metric=metric,$scope.available.metrics.$promise.then(function(){return $scope.type=$scope.metrics[$scope.metric].type})}),$scope.metricHasProjections=function(){var type;return type=$scope.type,"set"===type||"time"===type},$scope.availableProjections=function(){var all,available,percentiles,type;return(type=$scope.type)?(percentiles=["p50","p80","p90","p95","p99"],all={"set":["avg","max","min"],"count":["count"],"last":["last"]},available=all[type]):void 0},$scope.noProjectionsAreChecked=function(){var projections,query;return query=$scope.query,projections=$scope.availableProjections($scope.type),!_(projections).find(function(proj){return query.projections[proj]===!0})}})}.call(this),function(){angular.module("slug.services.demo",["slug.service","slug.services"]).factory("DemoService",function(Service,uuid){return{"create":function(demo,callback){var endpoints,service;return endpoints=[{"url":demo.endpoint,"code":demo.key}],service={"name":""+demo.name+" API","description":demo.description,"endpoints":endpoints,"demo":demo.key},Service.save(service,callback)},"update":function(service,demo){var endpoints;return endpoints=[{"url":demo.endpoint,"code":demo.key+uuid().substr(0,8)}],angular.extend(service,{"name":""+demo.name+" API","description":demo.description,"endpoints":endpoints,"demo":demo.key})}}}).factory("DemoApis",function(){var apis;return apis=[{"key":"echo","name":"Echo","img":"echo.png","endpoint":"https://echo-api.herokuapp.com","description":"Echo is simple service which responds for every request with JSON containing the request information. Like looking in the mirror. Useful for debugging middlewares.","calls":[{"url":"/","name":"GET /","method":"GET"},{"url":"/","name":"POST /","method":"POST"},{"url":"/url","name":"GET /url","method":"GET"},{"url":"/whatever","name":"PUT /whatever","method":"PUT"}]},{"key":"github","name":"GitHub","img":"github.png","endpoint":"https://api.github.com","description":"GitHub has Hypermedia JSON API. Some parts are public & rate limited to 60 requests per hour. You can use OAuth to authenticate and use up to 5,000 requests per hour.","calls":[{"url":"/events?per_page=1","name":"Get public events","method":"GET"},{"url":"/gists/public?per_page=1","name":"Get public gists","method":"GET"},{"url":"/orgs/github/events","name":"Get GitHub events","method":"GET"},{"url":"/gists/public","name":"Get public gists","method":"GET"},{"url":"/zen","name":"Get a zen koan","method":"GET"},{"url":"/emojis","name":"Get all emojis","description":"Do you see any Teletubbies in here? Do you see a slender plastic tag clipped to my shirt with my name printed on it? Do you see a little Asian child with a blank expression on his face sitting outside on a mechanical helicopter that shakes when you put quarters in it? No?"},{"url":"/users/vmg/starred","name":"Get repos starred by vmg","method":"GET"},{"url":"/repos/nginx/nginx/stargazers","name":"Get nginx/nginx stargazers","method":"GET"},{"url":"/repos/github/hubot/issues","name":"Get issues in github/hubot","method":"GET"}]},{"key":"facebook","name":"Facebook","img":"facebook.png","endpoint":"https://graph.facebook.com","description":"Facebook has JSON API which is mostly protected by OAuth, but some parts of Graph API are open.","calls":[{"url":"/mike.shaver","name":"Get info about a user","method":"GET"},{"url":"/19292868552","name":"Get info about a page","method":"GET"}]},{"key":"reddit","name":"Reddit","img":"reddit.png","endpoint":"http://www.reddit.com/","description":"Reddit has both JSON and XML api (which is open source) with some open parts, but most of it is behind OAuth.","calls":[{"url":"/user/peter/about.json","name":"Get info about a user","method":"GET"},{"url":"/subreddits/new.json","name":"Get new subreddits","method":"GET"},{"url":"/subreddits/search.json?q=kitten","name":'Search subreddits for "kitten"',"method":"GET"},{"url":"/random.json","name":"Get a random subreddit","method":"GET"},{"url":"/api/username_available.json?user=peter","name":"Check username availability","method":"GET"}]},{"key":"stackexchange","name":"Stack Exchange","img":"stackoverflow.png","endpoint":"https://api.stackexchange.com/2.1","description":"Stack Exchange has JSON API which is mostly open to public with some parts with OAuth authentication.","calls":[{"url":"/badges?site=stackoverflow","name":"Get all badges","method":"GET"},{"url":"/answers?site=stackoverflow","name":"Get lastest answers","method":"GET"},{"url":"/questions?tagged=lua&site=stackoverflow","name":"Get latest Lua questions","method":"GET"},{"url":"/similar?title=get%20css%20by%20ajax&site=stackoverflow","name":"Get similar questions","method":"GET"},{"url":"/tags/lua/top-askers/all_time?site=stackoverflow","name":"Get top Lua askers","method":"GET"},{"url":"/tags/java/synonyms?site=stackoverflow","name":"Get Java tag synonyms","method":"GET"}]},{"key":"wikipedia","name":"Wikipedia","img":"wikipedia.png","endpoint":"http://en.wikipedia.org/w/api.php","description":"Wikipedia has API with many output formats like: json, php, yaml, txt, xml, ....","calls":[{"url":"?format=php&action=query&titles=David%20Hasselhoff","name":"Get David Hasselhoff page, as PHP","method":"GET"},{"url":"?format=json&action=query&titles=Austin_powers&prop=revisions","name":"Get page revisions","method":"GET"},{"url":"?format=json&action=query&titles=Earth|Wind|Fire","name":"Search Earth, Wind or Fire","method":"GET"},{"url":"?format=json&action=sitematrix","name":"Get sitematrix","method":"GET"},{"url":"?format=json&action=compare&fromtitle=red&totitle=green","name":"Compare Red and Green","method":"GET"}]},{"key":"bitbucket","name":"Bitbucket","img":"bitbucket.png","endpoint":"https://bitbucket.org/api","description":"Bitbucket has JSON REST API with public access to open source repositories.","calls":[{"url":"/2.0/repositories/rude/love/commits","name":"Get repo commits","method":"GET"},{"url":"/1.0/repositories/rude/love/followers","name":"Get repo followers","method":"GET"},{"url":"/1.0/repositories/rude/love/events","name":"Get repo events","method":"GET"},{"url":"/1.0/repositories/rude/love/branches","name":"Get repo branches","method":"GET"}]}],_(apis).indexBy("key")}).factory("DemoCall",function($http){return{"perform":function(service,call){var params;return params={"url":call.url,"args":call.args,"body":call.body,"method":call.method},$http({"method":"GET","url":"/api/services/"+service._id+"/call","cache":!1,"params":params,"transformResponse":[]})}}}).controller("DemoCallCtrl",function($scope,DemoCall,$analytics){var updateResponse;return updateResponse=function(response){var _ref;return $scope.loading=!1,$scope.response=response.data,$scope.status=response.status,$scope.contentType=null!=(_ref=response.headers("Content-Type"))?_ref.split(";")[0]:void 0},$scope.perform=function(){var call;return $scope.loading=!0,call=DemoCall.perform($scope.service,$scope.call),call.then(updateResponse,updateResponse),$analytics.eventTrack("demo_call.used",{"service_id":$scope.service._id,"demo":$scope.service.demo,"call":$scope.call})}}).directive("demoCall",function(){return{"scope":{"call":"=demoCall","service":"=demoService"},"controller":"DemoCallCtrl","template":'<div class="call">\n  <span ng-class="{visible: response && !loading}"\n    class="status-code label label-{{ status | status }}">\n    {{ status }}\n  </span>\n  <button class="btn-call" type="button" ng-disabled="loading"\n    ng-click="perform()">\n    <i ng-class="{\'icon-refresh\': loading,\n      \'icon-cloud-download\': !loading}" ></i> {{ call.name }}\n      </button>\n\n\n  <span class="loading" ng-show="loading">loading&hellip;</span>\n    <span ng-if="response">\n      <a class="demo-response" ng-href="services/{{service._id}}/traces">\n        See response <i class="icon-chevron-right"></i>\n      </a>\n    </span>\n</div>'}})}.call(this),function(){angular.module("slug.home",["ui.router","slug.service","slug.services.demo","angular-flash.service"]).config(function($stateProvider,ServicesResolver){return $stateProvider.state("welcome",{"url":"/welcome","controller":"HomeCtrl","templateUrl":"/home/index.html","resolve":{"services":ServicesResolver}})}).controller("HomeCtrl",function($scope,services,DemoApis){return $scope.services=services,$scope.demos=DemoApis}).controller("HomeDemoCtrl",function($scope,DemoService,flash,$analytics,$state){return $scope.createDemo=function(){return DemoService.create($scope.demo,function(service){return flash.success=""+service.name+" created",$analytics.eventTrack("demo.created",{"demo":service.demo}),$scope.service=service})},$scope.service=_($scope.services).find(function(service){return service.demo===$scope.key}),$scope.servicePath=function(){var id,_ref;return id=null!=(_ref=$scope.service)?_ref._id:void 0,id?"/app"+$state.href("service.show",{"serviceId":id}):void 0}}).directive("slugToggleClass",function(){return{"restrict":"A","link":function(scope,element){return element.on("click",".toggle-item",function(){return element.toggleClass("opened")})}}})}.call(this),function(){angular.module("slug.middlewares",["ui.router","ui.bootstrap.modal","slug.service","slug.middleware_specs","ui.codemirror","ui.sortable","slug.controllers","ngResource"]).config(function($stateProvider){return $stateProvider.state("service.middleware",{"parent":"service","url":"/middlewares","templateUrl":"/pipeline/index.html","controller":"PipelineCtrl","resolve":{"pipeline":function(Pipeline,$stateParams){return Pipeline.get({"service_id":$stateParams.serviceId}).$promise}}}).state("service.middleware.edit",{"parent":"service.middleware","url":"/:middlewareUuid","controller":"MiddlewareEditCtrl"}).state("service.middleware.destroy",{"parent":"service.middleware","url":"/destroy","templateUrl":"/middlewares/destroy.html","controller":"MiddlewareDestroyCtrl"})}).directive("middleware",function(){return{"template":'<div class="header">\n  <strong tooltip="{{middleware.name}}" tooltip-append-to-body="true">{{ middleware.name | truncate: 35 }}</strong>\n  <ul class="controls">\n    <li><button class="btn-link" ng-click="select(middleware)">\n      <i class="icon-pencil"></i>\n    </button></li>\n    <li><button class="btn-link" ng-click="toggle(middleware)">\n      <i class="icon-{{middleware.active ? \'off\' : \'ok-circle\' }}"></i>\n    </button></li>\n    <li><button class="btn-link" ng-click="remove(middleware)">\n      <i class="icon-trash"></i>\n    </button></li>\n  </ul>\n</div>\n<div class="body"><em tooltip="{{middleware.description}}" tooltip-append-to-body="true">{{ middleware.description | truncate: 100}}</em></div>\n\n',"link":function(scope,element){return scope.$watch("middleware.active",function(active){return element.toggleClass("on",!!active).toggleClass("off",!active)}),scope.$watch("middleware == selected",function(selected){return element.toggleClass("selected",!!selected)}),scope.$watch("middleware.$updated",function(status){return element.toggleClass("updated",!!status)}),scope.$watch("middleware.$new",function(status){return element.toggleClass("new",!!status)}),element.addClass("middleware")}}}).factory("Pipeline",function($resource){return $resource("/api/services/:service_id/pipeline/",{"service_id":"@service_id"})}).factory("Middlewares",function(DefaultMiddlewareCode,uuid){var Middlewares;return Middlewares=function(){function Middlewares(middlewares){var pipeline;pipeline=angular.copy(middlewares),this.array=_.values(pipeline),this.array=_(this.array).sortBy(function(mid){return mid.position})}return Middlewares.prototype.addEmpty=function(){var empty;return empty={"name":"new middleware","description":"You can edit this description.","code":DefaultMiddlewareCode,"uuid":uuid(),"active":!0,"$new":!0},this.array.push(empty),empty},Middlewares.prototype.replace=function(original,updated){var index;return index=this.array.indexOf(original),updated?(index>=0&&(null!=updated&&(updated.$updated=!0),this.array[index]=updated),updated):this.remove(original)},Middlewares.prototype.get=function(uuid){var UUIDEquals;return UUIDEquals=function(middleware){return middleware.uuid===uuid},_(this.array).find(UUIDEquals)},Middlewares.prototype.remove=function(original){var index;return index=this.array.indexOf(original),this.array.splice(index,1)},Middlewares.prototype.valueOf=function(){return this.array.length},Middlewares.prototype.toPipeline=function(){var index,middleware,pipeline,_i,_len,_ref;for(index=0,pipeline={},_ref=this.array,_i=0,_len=_ref.length;_len>_i;_i++)middleware=_ref[_i],middleware.position=index++,pipeline[middleware.uuid]=middleware;return pipeline},Middlewares}()}).factory("TemporaryChanges",function(){var TemporaryChanges;return TemporaryChanges=function(){function TemporaryChanges(){this.store=[]}return TemporaryChanges.prototype["new"]=function(original){var copy;return copy={"original":original,"copy":null},this.store.push(copy),copy},TemporaryChanges.prototype.find=function(original){var _ref;return(null!=(_ref=this.get(original))?_ref.copy:void 0)||original},TemporaryChanges.prototype.get=function(original){return _(this.store).find(function(s){return s.original===original})},TemporaryChanges.prototype["for"]=function(original){return this.get(original)||this["new"](original)},TemporaryChanges.prototype["delete"]=function(original){return this.store=_(this.store).without(this.get(original))},TemporaryChanges}()}).controller("PipelineCtrl",function($scope,$state,$stateParams,pipeline,Middlewares,flash,TemporaryChanges,uuid,$analytics){return $scope.pipeline=pipeline,$scope.middlewares=new Middlewares(pipeline.middlewares),$scope.revertPipeline=function(){return $scope.middlewares=new Middlewares($scope.pipeline.middlewares)},$scope.$watch("middlewares.count()",function(count){return $scope.counterReset={"counter-reset":"li "+(count+1)}}),$scope.$on("$stateChangeSuccess",function(event,toState,toParams,fromState){return"service.middleware.edit"===fromState.name&&"middleware"===toState.name?$scope.select(null):void 0}),$scope.temporary_changes=new TemporaryChanges,$scope.addEmptyMiddleware=function(){var middleware;return middleware=$scope.middlewares.addEmpty(),$scope.select(middleware),$analytics.eventTrack("middleware.added.empty")},$scope.select=function(middleware){var params;return middleware===$scope.selected&&(middleware=null),$scope.selected=middleware,middleware?(params=angular.extend($stateParams,{"middlewareUuid":middleware.uuid}),$scope.middleware=middleware,$state.transitionTo("service.middleware.edit",params,!1)):$state.transitionTo("service.middleware",$stateParams)
},$scope.remove=function(middleware){return $scope.middlewares.remove(middleware),$analytics.eventTrack("middleware.removed",{"middleware":middleware.uuid})},$scope.toggle=function(middleware){return middleware.active=!middleware.active,$scope.select(null),$analytics.eventTrack("middleware.toggled",{"middleware":middleware.uuid})},$scope.github={"middleware":[{"name":"HODOR","author":{"name":"kikito"},"description":"hodor, hodor, hodor"}]},$scope.updatedMiddlewares=function(){var middlewares;return middlewares=$scope.middlewares,null==middlewares?{}:middlewares.toPipeline()},$scope.pipelineChanged=function(){var middlewares;return middlewares=$scope.pipeline.middlewares,$scope.middlewares?!angular.equals(middlewares,$scope.updatedMiddlewares()):void 0},$scope.updatePipeline=function(){return pipeline=$scope.pipeline,pipeline.middlewares=$scope.updatedMiddlewares()},$scope.savePipeline=function(callback){return $scope.updatePipeline(),flash.info="Saving...",$scope.pipeline.$save(function(){return flash.success="Pipeline changed",$scope.revertPipeline(),$analytics.eventTrack("pipeline.saved"),"function"==typeof callback?callback($scope.middlewares):void 0})},$scope.newMiddleware=function(spec){var middleware;return middleware={},middleware.name=spec.name,middleware.description=spec.description,middleware.code=spec.code,spec.empty||(middleware.spec_id=spec._id),middleware.uuid=uuid(),middleware.$new=!0,middleware},$scope.$on("drag.start",function(){return $scope.$apply(function(){return $scope.is_dragged=!0})}),$scope.$on("drag.stop",function(){return $scope.$apply(function(){return delete $scope.is_dragged})}),$scope.sortOptions={"axis":"y","cursor":"move","items":"> li.middleware","connectWith":".middleware-list.local","stop":function(event,ui,sortable){var _ref;return null!=(_ref=sortable.moved)?_ref.$updated=!0:void 0},"receive":{"pre":function(event,ui,state){var middleware,sortable,spec,_ref;return(spec=ui.item.scope().$eval("spec"))?(middleware=$scope.newMiddleware(spec),sortable=$(event.target).data("ui-sortable"),state.currentItem=sortable.currentItem,state.index=null!=(_ref=state.currentItem)?_ref.index(".middleware"):void 0,middleware.active=!0,state.moved=middleware):void 0},"post":function(event,ui,state){var _ref;return null!=(_ref=state.currentItem)&&_ref.remove(),$analytics.eventTrack("middleware.added",{"middleware":state.moved})}}},$scope.helpTemplate="pipeline"}).controller("MiddlewareEditCtrl",function($scope,$state,$stateParams,$modal){var changes,middleware,modal;return $scope.middleware||($scope.middleware=$scope.middlewares.get($stateParams.middlewareUuid)),changes=$scope.temporary_changes,middleware=changes.find($scope.middleware),$scope.save=function(uuid,updated_middleware){var original;return original=$scope.middlewares.get(uuid),$scope.middleware=$scope.middlewares.replace(original,updated_middleware)},modal=$modal.open({"templateUrl":"/middlewares/edit.html","controller":"MiddlewareFormCtrl","backdrop":"static","windowClass":"modal modal-full modal-fill-flex modal-slug draggable: dragOptions; middleware-edit","resolve":{"middleware":function(){return angular.copy(middleware)},"changes":function(){return changes["for"]($scope.middleware)},"savePipeline":function(){return $scope.savePipeline},"save":function(){return $scope.save}}}),$scope.close=function(result){return result?void 0:(changes["delete"]($scope.middleware),$state.transitionTo("service.middleware",$stateParams,!1))},modal.result.then($scope.close)}).factory("MiddlewareLog",function($resource,$state){return $resource("/api/services/:serviceId/console/:middlewareUuid",{"serviceId":function(){return $state.params.serviceId},"middlewareUuid":function(){return $state.params.middlewareUuid}})}).controller("MiddlewareFormCtrl",function($scope,$browser,$timeout,$state,middleware,save,savePipeline,changes,MiddlewareLog,$loop){var logsLoop,stopChanges,uuid;return uuid=middleware.uuid,$scope.middleware=middleware,$scope.original=angular.copy(middleware),$scope.hasSpec=!!middleware.spec_id,$scope.codemirror={"lineNumbers":!0,"lineWrapping":!0,"tabSize":2,"onLoad":function(editor){var refreshCodemirror,time,_i,_results;for(refreshCodemirror=function(){return editor.refresh()},_results=[],time=_i=200;900>=_i;time=_i+=100)_results.push($timeout(refreshCodemirror,time));return _results}},logsLoop=$loop($scope,function(){return MiddlewareLog.query({"how_many":20}).$promise.then(function(logs){return $scope.logs=logs,logsLoop.schedule()})}),$scope.canBeShared=function(){return $scope.sameAsOriginal()&&!middleware.$updated&&!middleware.$new},$scope.sameAsOriginal=function(){return angular.equals($scope.middleware,$scope.original)},$scope.close=$scope.$close,$scope.share=function(){return $state.transitionTo("spec.share",{"middlewareUuid":$scope.middleware.uuid})},$scope.save=function(){return save(uuid,$scope.middleware),$scope.close()},$scope.saveMetaOnEnter=function(target,keyCode){return 13===keyCode?this[target]=!1:void 0},$scope.saveAndDeploy=function(){var updateOriginal,updated;return updated=save(uuid,$scope.middleware),updateOriginal=function(middlewares){return $scope.middleware=middleware=middlewares.get(updated.uuid),$scope.original=angular.copy(updated)},savePipeline(updateOriginal)},$scope.dragOptions={"start":function(event,ui){return ui.helper.addClass("dragged")},"handle":".modal-header"},$scope["delete"]=function(){return save(uuid),$scope.close()},stopChanges=$scope.$on("$stateChangeStart",function(){return $browser.defer(function(){return $scope.$apply(function(){return $scope.$dismiss()})}),changes.copy=$scope.middleware}),$scope.isLogCollapse=!1}).controller("MiddlewareSpecBarCtrl",function($scope,MiddlewareSpec){return $scope.moreLocal=function(n){var i,spec,_i,_results;for(null==n&&(n=5),_results=[],i=_i=1;n>=1?n>=_i:_i>=n;i=n>=1?++_i:--_i)_results.push((spec=$scope.all_specs.pop())?$scope.specs.push(spec):void 0);return _results},$scope.moreGitHub=function(n){null==n&&(n=5)},$scope.all_specs=MiddlewareSpec.query(function(){return $scope.moreLocal(4)}),$scope.specs=[],$scope.dragOptions={"connectToSortable":".pipeline .middleware-list","helper":"clone","distance":0,"revert":"invalid","start":function(e,ui){var source;return source=$(e.target),ui.helper.css("max-width",source.width()),$scope.$emit("drag.start")},"stop":function(){return $scope.$emit("drag.stop")}}})}.call(this),function(){angular.module("slug.middleware_specs",["ui.router"]).config(function($stateProvider){return $stateProvider.state("specs",{"abstract":!0,"url":"/middlewares","views":{"":{"controller":"MiddlewareSpecCtrl","template":'<ui-view name="main"></ui-view>'}}}).state("specs.list",{"url":"/","views":{"main":{"templateUrl":"/middleware_specs/index.html","controller":"MiddlewareSpecsListCtrl"}}}).state("spec.new",{"parent":"specs","url":"/new","views":{"main":{"templateUrl":"/middleware_specs/new.html","controller":"MiddlewareSpecNewCtrl"}}}).state("spec",{"parent":"specs","url":"/:middlewareSpecId","views":{"main":{"templateUrl":"/middleware_specs/show.html","controller":"MiddlewareSpecShowCtrl"}}}).state("spec.share",{"parent":"spec.new","url":"/:middlewareUuid","views":{"main@specs":{"templateUrl":"/middleware_specs/new.html","controller":"MiddlewareSpecNewFromCtrl"}}}).state("spec.edit",{"parent":"spec","url":"/edit","views":{"main@specs":{"templateUrl":"/middleware_specs/edit.html","controller":"MiddlewareSpecEditCtrl"}}}).state("spec.github",{"parent":"spec","url":"/github","views":{"main@specs":{"templateUrl":"/middleware_specs/github.html","controller":"MiddlewareSpecGithubCtrl"}}})}).factory("DefaultMiddlewareCode",function(){return"return function(request, next_middleware)\n  -- every middleware has to call next_middleware,\n  -- so others have chance to process the request/response\n\n  -- deal with request\n  local response = next_middleware()\n  send.notification({msg=response.status, level='info'})\n  -- deal with response\n  return response\nend"}).factory("MiddlewareSpec",function($resource){return $resource("/api/middleware_specs/:id",{"id":"@_id"})}).controller("MiddlewareSubscriptionCtrl",function($scope,GitHubSpec,GitHubSearchCode){return $scope.spec={"user":"3scale","repo":"no500-brainslug"},$scope.search=function(){var query;return query=[$scope.query,"language:json","in:file","path:brainslug.json"].join(" "),GitHubSearchCode.get({"q":query},function(results){var item;return $scope.results=function(){var _i,_len,_ref,_results;for(_ref=results.items,_results=[],_i=0,_len=_ref.length;_len>_i;_i++)item=_ref[_i],_results.push(GitHubSpec.get({"user":item.repository.owner.login,"repo":item.repository.name}));return _results}()})},$scope.load=function(){return $scope.results=[],GitHubSpec.get($scope.spec,function(result){return $scope.results.push(result)}),GitHubSpec.get($scope.spec,function(result){return $scope.results.push(result)}),GitHubSpec.get($scope.spec,function(result){return $scope.results.push(result)})}}).controller("MiddlewareSpecCtrl",function($scope,$state,$stateParams,flash){return $scope.save=function(spec){return spec.$save(function(){return flash.success="Middleware Spec "+spec.name+" saved",$state.transitionTo("specs.list")})}}).controller("MiddlewareSpecsListCtrl",function($scope,MiddlewareSpec,$location,GitHub){return GitHub.user||(GitHub.user="mikz"),GitHub.token.set("60b6f9b60278b86a843d34f52558df7f016f0399"),$scope.github=GitHub,$scope.specs=MiddlewareSpec.query(),$scope.badges=function(spec){return spec.badges||(spec.badges=[{"icon":"icon-hdd","name":"local"},{"icon":"icon-github","name":"GitHub"},{"icon":"icon-code-fork","name":"fork"},{"icon":"icon-code-unlock","name":"public"}])},$scope.rating=function(spec){var i,rating,stars,_i,_j,_ref;if(spec.rating)return spec.rating;for(rating=Math.ceil(5*Math.random()),stars=[],i=_i=1;rating>=_i;i=_i+=1)stars.push({"icon":"icon-heart"});for(i=_j=_ref=rating+1;5>=_j;i=_j+=1)stars.push({"icon":"icon-heart-empty"});return spec.rating=stars}}).controller("MiddlewareSpecNewCtrl",function($scope,MiddlewareSpec){return $scope.spec=new MiddlewareSpec}).controller("MiddlewareSpecShowCtrl",function($scope,$stateParams,MiddlewareSpec,flash){return $scope.spec=MiddlewareSpec.get({"id":$stateParams.middlewareSpecId}),$scope.save=function(spec){return null==spec&&(spec=$scope.spec),spec.$save(function(){return flash.success="Middleware Spec "+spec.name+" saved"})}}).controller("MiddlewareSpecEditCtrl",function($scope,$stateParams,MiddlewareSpec){var _base;return $scope.spec=MiddlewareSpec.get({"id":$stateParams.middlewareSpecId}),(_base=$scope.spec).author||(_base.author={})}).controller("MiddlewareSpecNewFromCtrl",function($scope,$stateParams,Middleware,MiddlewareSpec){return $scope.spec||($scope.spec=new MiddlewareSpec),$scope.middleware=Middleware.get({"uuid":$stateParams.middlewareUuid},function(middleware){var attributes;return attributes={"code":middleware.code,"name":middleware.name,"description":middleware.description},angular.extend($scope.spec,attributes)})}).controller("MiddlewareSpecGithubCtrl",function($scope,$stateParams,MiddlewareSpec,flash,GitHub,GitHubIntegrator,GitHubMessages,GitHubToken,GitHubValidator){var github,_ref;return $scope.spec||($scope.spec=$scope.$parent.spec),github=$scope.github=angular.copy(null!=(_ref=$scope.spec)?_ref.github:void 0)||{},github.owner||(github.owner=GitHub.user),github.repo||(github.repo=GitHub.repoSuggestion($scope.spec)),GitHubToken.set("60b6f9b60278b86a843d34f52558df7f016f0399"),$scope.save=function(spec){return null==spec&&(spec=$scope.spec),spec.github=github,spec.$save(function(){return flash.success="Middleware GitHub integration saved",$scope.form.$setPristine()})},$scope.validate=function(){var failure,success;return $scope.messages=new GitHubMessages($scope.spec,github),$scope.valid=!1,success=function(){return $scope.valid=!0},failure=function(){return $scope},GitHubValidator($scope.messages).then(success,failure)},$scope.setUpIntegration=function(){var failure,success;return success=function(){return console.log("success")},failure=function(){return console.log("failure")},GitHubIntegrator($scope.messages).then(success,failure)}}).controller("MiddlewareSpecWizardCtrl",function($scope,$stateParams,$location,Middleware,DefaultMiddlewareCode,MiddlewareSpec,flash,$state){var nextStep,template,uuid;return $scope.spec=new MiddlewareSpec({"code":DefaultMiddlewareCode}),(uuid=null!=$stateParams.middlewareUuid)&&($scope.middleware=Middleware.get({"uuid":uuid},function(middleware){var attributes;return attributes=_(middleware).pick("code","name","description"),angular.extend($scope.spec,attributes)})),$scope.current_step||($scope.current_step=0),$scope.steps=["General Info","Author","Middleware"],$scope.next=function(){var step;return(step=nextStep())?template(step):$scope.save()},$scope.goTo=function(index){return template(index+1)},nextStep=function(){var current,steps;return steps=$scope.steps.length,current=$scope.current_step,steps>current?$scope.current_step=++current:void 0},template=function(step){var direction,enter,leave,_ref;return direction=$scope.current_step<step,_ref=direction?["fadeInLeftBig","fadeOutRightBig"]:["fadeInRightBig","fadeOutLeftBig"],enter=_ref[0],leave=_ref[1],$scope.slideAnimation={"enter":"animated enter "+enter,"leave":"animated leave "+leave},$scope.last_step=step===$scope.steps.length,$scope.current_template="/middleware_specs/wizard/"+step+".html"},$scope.next(),$scope.stepState=function(index){var current,step;return current=$scope.current_step,step=++index,step>current?"future":step===current?"current":current>step?"past":void 0},$scope.save=function(spec){return null==spec&&(spec=$scope.spec),spec.$save(function(){return flash.success="Middleware Spec "+spec.name+" saved",$state.transitionTo("specs.list")})}})}.call(this),function(){var slug;slug=angular.module("slug.controllers"),slug.controller("NavController",function($scope,$state,Service,ServiceSubmenu){return $scope.hideMenu=function(){return $state.is("welcome")},$scope.submenu_template="/services/_submenu.html",$scope.submenu=ServiceSubmenu,$scope.submenu.services=Service.query()}),slug.directive("navigation",function(){return{"controller":"NavController","scope":{}}})}.call(this),function(){angular.module("slug.notifications",["ngResource","slug.search","angular-flash.service","infinite-scroll","slug.directives.filter"]).config(function($stateProvider){return $stateProvider.state("notifications",{"url":"/notifications?filter&select","templateUrl":"/notifications/index.html","controller":"NotificationsListCtrl"})}).controller("NotificationsNavigationCtrl",function($scope,$state,flash,EventsFilter){return $scope.filters.$promise.then(function(){var filter,name;return $scope.filters.unshift(new EventsFilter({"name":"Middlewares","icon":"cogs","builtin":!0,"tokens":[{"key":"channel","op":"=","value":"middleware","active":!0}]})),$scope.filters.unshift(new EventsFilter({"name":"Stats","icon":"bar-chart","builtin":!0,"tokens":[{"key":"channel","op":"=","value":"stats","active":!0}]})),$scope.filters.unshift(new EventsFilter({"name":"Syslog","icon":"desktop","builtin":!0,"tokens":[{"key":"channel","op":"=","value":"syslog","active":!0}]})),$scope.filters.unshift(new EventsFilter({"name":"Notifications","builtin":"notifications","icon":"asterisk","tokens":[{"key":"level","op":"@","value":"error","active":!0},{"key":"level","op":"@","value":"alert","active":!0},{"key":"level","op":"@","value":"warn","active":!0},{"key":"level","op":"@","value":"info","active":!0}]})),$scope.filters.unshift(new EventsFilter({"name":"Errors","builtin":"errors","icon":"asterisk","tokens":[{"key":"level","op":"@","value":"error","active":!0},{"key":"level","op":"@","value":"alert","active":!0},{"key":"level","op":"@","value":"warn","active":!0}]})),(name=$state.params.filter)&&(filter=_.find($scope.filters,function(f){return f.builtin===name}))?$scope.search.use(filter):void 0}),$scope.helpTemplate="notifications"}).factory("Event",function($resource){return $resource("/api/events/:id/:action",{"id":"@_id"},{"star":{"method":"POST","isArray":!1,"params":{"action":"star"}},"unstar":{"method":"DELETE","isArray":!1,"params":{"action":"star"}},"search":{"method":"GET","isArray":!0,"params":{}},"count":{"method":"GET","isArray":!1,"params":{"action":"count"}},"wipe":{"method":"DELETE","params":{"id":"all"}}})}).factory("EventsFilter",function($resource){return $resource("/api/filters/events/:id",{"id":"@_id"})}).controller("NotificationsListCtrl",function($scope,$state,Event,Search,flash,EventsFilter,$stateParams){return $scope.selected_event=$stateParams.select,$scope.search=new Search(Event,$scope),$scope.filters=EventsFilter.query(),$scope.newFilter=function(tokens){return new EventsFilter({"tokens":tokens,"name":"new filter"})},$scope.highlight=function(event){return Event.highlight({"id":event._id},{"highlighted":!0})},$scope.wipe=function(){return Event.wipe(function(){return $scope.search["do"]()}),flash.info="All notifications have been removed."}})}.call(this),function(){angular.module("slug.root",["ui.router","slug.setup"]).config(function($urlRouterProvider){return $urlRouterProvider.when("/","/setup")})}.call(this),function(){var __bind=function(fn,me){return function(){return fn.apply(me,arguments)}};angular.module("slug.service",["ngResource","ui.router","slug.service_submenu.service"]).factory("Service",function($resource,$location){var Service;return Service=$resource("/api/services/:id",{"id":"@_id"}),Service.prototype.host=function(){return""+this.code()+"-"+$location.host()},Service.prototype.code=function(){var _ref;return null!=(_ref=this.endpoints[0])?_ref.code:void 0},Service}).constant("ServicesResolver",function(Service){return Service.query().$promise}).constant("ServiceResolver",function($stateParams,Service){return Service.get({"id":$stateParams.serviceId}).$promise}).config(function($stateProvider,ServicesResolver,ServiceResolver,ServiceSubmenu){var services;return services={"service":ServiceResolver,"services":ServicesResolver},$stateProvider.state("services",{"url":"/services","templateUrl":"/services/index.html","controller":"ServicesListCtrl"}).state("service-new",{"url":"/services/new","templateUrl":"/services/new.html","controller":"ServiceNewCtrl","onEnter":function(){return ServiceSubmenu.show=!1},"onExit":function(){return ServiceSubmenu.show=!0}}).state("service",{"url":"/services/:serviceId","abstract":!0,"controller":"ServiceCtrl","templateUrl":"/services/layout.html","resolve":services,"onEnter":function(service){return ServiceSubmenu.service=angular.copy(service),ServiceSubmenu.active=!0},"onExit":function(){return ServiceSubmenu.active=!1}}).state("service.show",{"url":"/integration","parent":"service","templateUrl":"/services/show.html","controller":"ServiceShowCtrl","resolve":services}).state("service.demo",{"url":"/demo_calls","parent":"service","templateUrl":"/services/demo_calls.html","controller":"ServiceDemoCallsCtrl"}).state("service.edit",{"parent":"service","url":"/edit","templateUrl":"/services/edit.html","controller":"ServiceEditCtrl"}).state("service.destroy",{"parent":"service","url":"/destroy","views":{"@":{"templateUrl":"/services/destroy.html","controller":"ServiceDestroyCtrl"}}})}),angular.module("slug.controllers.services",["slug.services","slug.controllers","slug.stats","ngResource","slug.services.demo"]).factory("ServiceStatsDashboard",function($resource,$state){return $resource("/api/services/:serviceId/stats/dashboard",{"serviceId":function(){return $state.params.serviceId}})}).factory("ServicesDashboard",function(Service,ServiceStatsDashboard,$q,$timeout){var ServicesDashboard;return ServicesDashboard=function(){function ServicesDashboard(){this.load_all_stats=__bind(this.load_all_stats,this),this.services=Service.query(),this.stats={}}return ServicesDashboard.prototype.when_ready=function(f){return this.services.$promise.then(f)},ServicesDashboard.prototype.load_service_stats=function(service_id){return ServiceStatsDashboard.get({"serviceId":service_id}).$promise.then(function(_this){return function(stats){return _this.stats[service_id]=stats}}(this))},ServicesDashboard.prototype.refresh=function($scope){var last_timeout,update_stats;return last_timeout=null,update_stats=function(_this){return function(){return _this.load_all_stats().then(function(){return last_timeout=$timeout(update_stats,1e4)})}}(this),$scope.$on("$destroy",function(){return $timeout.cancel(last_timeout)}),this.when_ready(update_stats)},ServicesDashboard.prototype.load_all_stats=function(){var promises,service;return promises=function(){var _i,_len,_ref,_results;for(_ref=this.services,_results=[],_i=0,_len=_ref.length;_len>_i;_i++)service=_ref[_i],_results.push(this.load_service_stats(service._id));return _results}.call(this),$q.all(promises)},ServicesDashboard}()}).controller("ServicesListCtrl",function($scope,ServicesDashboard){return $scope.dashboard||($scope.dashboard=new ServicesDashboard),$scope.dashboard.refresh($scope)}).controller("ServiceDashboardCtrl",function($scope){var stats;return stats=function(){return $scope.dashboard.stats[$scope.service._id]},$scope.$watch(stats,function(stats){return $scope.stats=stats}),$scope.template={"chart":{"height":150},"plotOptions":{"series":{"animation":!1}}}}).controller("ServiceCtrl",function($scope,services,service){return $scope.services||($scope.services=services),$scope.service=service}).controller("ServiceDemoCallsCtrl",function($scope,service,DemoApis){return $scope.demo=DemoApis[service.demo]}).controller("ServiceShowCtrl",function($scope,$location,service,DemoApis){var _ref;return $scope.endpoint=null!=(_ref=service.endpoints)?_ref[0].code:void 0,$scope.proxy_url=""+$location.protocol()+"://"+("function"==typeof service.host?service.host():void 0)+"/",$scope.demo=DemoApis[service.demo],$scope.integration=service.demo?"demo":"normal",$scope.helpTemplate="endpoints",$scope.copy=function(node){var clip,text;return text=node.textContent.trim(),clip=new ZeroClipboard,clip.setText(text)}}).controller("ServiceDestroyCtrl",function($scope,Service,$stateParams,flash,$location,$analytics){return $scope.service||($scope.service=Service.get({"id":$stateParams.serviceId})),$scope.destroy=function(){return flash.warning="Deleting Service ...",$scope.service.$remove(function(service){var equals,for_removal,index;return equals=_.partial(angular.equals,service),(for_removal=_($scope.services).find(equals))&&(index=$scope.services.indexOf(for_removal),$scope.services.splice(index,1)),flash.info="Service deleted",$analytics.eventTrack("service.deleted",{"service_id":service._id}),$location.path("services")})}}).controller("ServiceNewCtrl",function($scope,Service,DemoApis,DemoService,$analytics){return $scope.service=new Service({"endpoints":[{}]}),$scope.demos=DemoApis,$scope.$emit("serviceReset"),$scope.useDemo=function(demo){return DemoService.update($scope.service,demo),$analytics.eventTrack("demo.use",{"demo":demo})}}).controller("ServiceEditCtrl",function($scope,$state,$stateParams,Service,$location,$analytics,$rootScope){return $scope.service||($scope.service=Service.get({"id":$stateParams.serviceId})),$scope.suffix=$location.host(),$scope.resetDemo=function(){return delete $scope.service.demo,delete $scope.service.logo},$scope.save=function(){return $scope.service.$save(function(service){return $state.go("service.show",{"serviceId":service._id}).then(function(){return $rootScope.$emit("serviceUpdated",service),$analytics.eventTrack("service.save",{"service_id":service._id})})})}}).controller("ServiceEndpointCtrl",function($scope,uuid){var _base;return(_base=$scope.endpoint).code||(_base.code=uuid().substr(0,8)),$scope.original=angular.copy($scope.endpoint),$scope.edit=function(){return $scope.editing=!0},$scope.apply=function(){return $scope.original=angular.copy($scope.endpoint),$scope.editing=!1},$scope.cancel=function(){return angular.extend($scope.endpoint,$scope.original),$scope.editing=!1}})}.call(this),function(){angular.module("slug.setup",["ui.router","slug.user_settings"]).config(function($stateProvider){var Config;return Config={"config":function(UserSettings){return UserSettings.$promise}},$stateProvider.state("setup",{"url":"/setup","templateUrl":"/setup/show.html","controller":"SetupCtrl","resolve":Config}).state("pair",{"url":"/pair","templateUrl":"/setup/pair.html","controller":"PairCtrl","resolve":Config})}).controller("SetupCtrl",function($scope,$state,config,flash,OnPremise){var setup;return setup=$scope.setup={"report_usage":!0},config.get("set_up")&&$state.go("dashboard"),$scope.saveSetup=function(){var failure,update_config,uuid;return failure=function(){return flash.error="There was an error when setting up this Traffic Monitor. Dou you have internet connection?"},update_config=function(){return config.extend({"report_usage":setup.report_usage,"set_up":!0}),config.$promise.then(function(){return flash.success="Successfully set up your Traffic Monitor",$state.go("dashboard")})},setup.report_usage?(uuid=config.get("uuid"),OnPremise.register(uuid).then(update_config,failure)):update_config()}}).controller("PairCtrl",function($scope,$state,Brain,OnPremise){return Brain.$promise.then(function(){return $scope.get_key=""+Brain.host+"/on_premise/link"}),$scope.setup={},$scope.pair=function(){var key,linking;return key=$scope.setup.pairing_key,linking=OnPremise.link(key),linking.success(function(){return $state.go("dashboard")})}})}.call(this),function(){angular.module("slug.traces.services",["ngResource","slug.services.pretty_print"]).factory("ServiceTrace",function($resource,$state,Trace){var ServiceTrace;return ServiceTrace=$resource("/api/services/:service_id/traces/:id/:action/",{"id":"@_id","service_id":function(){return $state.params.serviceId}},{"search":{"method":"GET","isArray":!0,"params":{"action":"search_for_index"}},"count":{"method":"GET","isArray":!1,"params":{"action":"count"}},"wipe":{"method":"DELETE","params":{"id":"all"}},"redo":{"method":"POST","params":{"action":"redo"}}}),ServiceTrace.prototype.$trace=function(){return new Trace({"_id":this._id})},ServiceTrace.prototype.$star=function(f){return this.$trace().$star(f)},ServiceTrace.prototype.$unstar=function(f){return this.$trace().$unstar(f)},ServiceTrace}).factory("Trace",function($resource){return $resource("/api/traces/:id/:action/",{"id":"@_id"},{"search":{"method":"GET","isArray":!0,"params":{"action":"search_for_index"}},"count":{"method":"GET","isArray":!1,"params":{"action":"count"}},"star":{"method":"POST","isArray":!1,"params":{"action":"star"}},"unstar":{"method":"DELETE","isArray":!1,"params":{"action":"star"}},"wipe":{"method":"DELETE","params":{"id":"all"}},"redo":{"method":"POST","params":{"action":"redo"}}})}),angular.module("slug.traces",["slug.traces.services","slug.controllers","slug.services.filters","ui.bootstrap.dropdownToggle","ui.bootstrap.pagination","ui.bootstrap.collapse","slug.directives.highlight"]).controller("TracesNavigationCtrl",function($scope,$state,TracesFilter){return $scope.filters.$promise.then(function(){var filter,name;return $scope.filters.unshift(new TracesFilter({"_id":3,"name":"Starred","icon":"star","builtin":"starred","tokens":[{"key":"starred","op":"=","value":!0,"active":!0}]})),$scope.filters.unshift(new TracesFilter({"_id":2,"name":"Errors","icon":"minus-sign","builtin":"errors","tokens":[{"key":"res.status","op":">=","value":400,"active":!0},{"key":"res.status","op":"<=","value":600,"active":!0}]})),$scope.filters.unshift(new TracesFilter({"_id":1,"name":"Traffic","icon":"exchange","builtin":"traffic","tokens":[]})),(name=$state.params.filter)&&(filter=_.find($scope.filters,function(f){return f.builtin===name}))?$scope.search.use(filter):void 0}),$scope.helpTemplate="all_traces"}).controller("TracesIndexCtrl",function($scope,Service,Trace,Search,TracesFilter,flash){return $scope.search=new Search(Trace,$scope),$scope.services=Service.query(),$scope.redo=function(trace){var redo;return redo=Trace.redo({"_id":trace._id}),redo.$promise},$scope.filters=TracesFilter.query(),$scope.serviceCode=function(trace){var _ref;return $scope.services_hash||($scope.services_hash=_.indexBy($scope.services,"_id")),trace.$service_code||(trace.$service_code=null!=(_ref=$scope.services_hash[trace.service_id])?_ref.code():void 0)},$scope.newFilter=function(tokens){return new TracesFilter({"tokens":tokens,"name":"new filter"})},$scope["delete"]=function(trace){return trace.$remove(function(){return $scope.search.remove(trace),flash.success="Trace deleted"})},$scope.wipe=function(){return Trace.wipe(function(){return $scope.search["do"]()}),flash.info="All traces have been removed."},$scope.load=function(trace){var _ref;return null==(null!=(_ref=trace.res)?_ref.body:void 0)?Trace.get({"id":trace._id},function(full){return angular.extend(trace,full)}):void 0}}).controller("ServiceTracesIndexCtrl",function($scope,ServiceTrace,Search,flash,TracesFilter,Trace){return $scope.search=new Search(ServiceTrace,$scope),$scope.redo=function(trace){var redo;return redo=Trace.redo({"_id":trace._id}),redo.$promise},$scope.filters=TracesFilter.query(),$scope["delete"]=function(trace){return trace.$trace().$remove(function(){return $scope.search.remove(trace),flash.success="Trace deleted"})},$scope.wipe=function(){return ServiceTrace.wipe(function(){return $scope.search["do"]()}),flash.info="All traces have been removed."},$scope.helpTemplate="traces",$scope.newFilter=function(tokens){return new TracesFilter({"tokens":tokens,"name":"new filter"})},$scope.load=function(trace){var _ref;return null==(null!=(_ref=trace.res)?_ref.body:void 0)?Trace.get({"id":trace._id},function(full){return angular.extend(trace,full)}):void 0}}).controller("TraceShowCtrl",function($scope,Trace,Service,$stateParams,flash){return $scope.trace||($scope.trace=Trace.get({"id":$stateParams.traceId})),$scope.trace.$promise.then(function(trace){return $scope.service=Service.get({"id":trace.service_id})}),$scope.redo=function(){return $scope.trace.$redo(function(){return flash.success="Trace redone"})},$scope["delete"]=function(){return $scope.trace.$delete(function(){return flash.success="Trace deleted"})},$scope.toggleStar=function(){return $scope.trace.starred?$scope.trace.$unstar():$scope.trace.$star()}}).controller("TraceDestroyCtrl",function($scope,Trace,$stateParams){return $scope.trace||($scope.trace=Trace.get({"id":$stateParams.traceId}))}).controller("TraceBodyCtrl",function($scope,prettyPrint){return $scope.togglePrettyBody=function(){return $scope.original?($scope.body=$scope.original,delete $scope.original):($scope.original=$scope.body,$scope.body=prettyPrint($scope.contentType,$scope.body))}}).directive("slugTrace",function(){return{"scope":{"trace":"=slugTrace"},"templateUrl":function(element,attrs){return attrs.expanded?"/traces/_expanded_trace.html":"/traces/_trace.html"},"link":function(scope){return scope.response=scope.trace.res,scope.request=scope.trace.req}}}).directive("traceRequest",function(){return{"scope":{"request":"=traceRequest"},"templateUrl":function(element,attrs){return attrs.expanded?"/traces/_expanded_request.html":"/traces/_request.html"},"link":function(scope){var _ref;return scope.contentType=null!=(_ref=scope.request.headers)?_ref["Content-Type"]:void 0}}}).directive("traceResponse",function(){return{"scope":{"response":"=traceResponse"},"templateUrl":function(element,attrs){return attrs.expanded?"/traces/_expanded_response.html":"/traces/_response.html"},"controller":function($scope){return $scope.hasHeaders||($scope.hasHeaders=function(response){return!_.isEmpty(response.headers)})},"link":function(scope){var type,_ref;return(type=null!=(_ref=scope.response.headers)?_ref["Content-Type"]:void 0)?scope.contentType=type.split(";")[0]:void 0}}}).directive("traceHeaders",function(){return{"scope":{"headers":"=traceHeaders"},"templateUrl":"/traces/_headers.html"}}).directive("tracePipeline",function(){return{"scope":{"pipeline":"=tracePipeline"},"templateUrl":"/traces/_pipeline.html","controller":function($scope){return $scope.hasResponse||($scope.hasResponse=function(response){return response.status||response.body||!_.isEmpty(response.headers)})}}})}.call(this),function(){angular.module("slug.directives",["slug.directives.pretty_print","slug.directives.list","slug.directives.confirm","slug.directives.token_input","slug.directives.navigation","slug.directives.demo_block","slug.service_submenu"]).directive("apitools",function($http,$q){return{"restrict":"EA","scope":{},"compile":function(){var http,name;return name=$q.defer(),http=$http.get("/api/get_slug_name"),http.then(function(response){return name.resolve(response.data.slug_name)}),function(scope){return scope.name=name}}}}).directive("relHref",function($location){return{"link":function(scope,element,attrs){var href;
return href="."+$location.path()+attrs.relHref,element.attr("href",href).attr("target","_self")}}}).directive("preventDisabled",function(){return{"link":function(scope,element,attrs){return element.on(attrs.preventDisabled,function(){return!1})}}}).directive("zeroclipboard",function(){return{"link":function(scope,element){var button,clip;return button=angular.element('<button class="btn copy-to-clipboard"> <i class="icon-copy"></i></button>'),element.after(button),clip=new ZeroClipboard(button),clip.on("dataRequested",function(){return clip.setText($(this).prev().text())})}}}).directive("focus",function(){return{"link":function(scope,element){var giveFocus,isVisible;if(element.is("input"))return giveFocus=function(visible){return visible?element.focus():void 0},isVisible=function(){return element.is(":visible")},scope.$watch(isVisible,giveFocus)}}}).directive("fillHeight",function($window){var TRANSITION_END,window;return TRANSITION_END="webkitTransitionEnd oTransitionEnd transitionend msTransitionEnd",window=angular.element($window),{"link":function(scope,element,attributes){var body,parent,size,top,total;return body=element.closest(".modal-body"),parent=element.closest(attributes.fillHeight),window.on("resize.fillHeight",function(){return scope.$apply()}),element.closest(".modal").on(TRANSITION_END,function(){return scope.$apply()}),total=function(){return body.height()},top=function(){return parent.position().top},size=function(){return total()-top()},scope.$on("destroy",function(){return window.unbind("resize.fillHeight")}),scope.$watch(size,function(size){return element.css("height",size)})}}}).directive("author",function(){return{"scope":{"author":"="},"link":function(scope,element){var author,github,link,name;return(author=scope.author)?(link=angular.element("<a/>"),name=author.name,(github=author.github)?(link.attr({"title":name}),link.attr({"href":"//github.com/"+github}),link.text("@"+github)):link.text(name),element.html(link)):void element.text("unknown")}}}).directive("truncate",function($interpolate,$compile){return{"restrict":"A","scope":!0,"link":function(scope,element,attributes){var expression,interpolate,length,template;return template='<span class="truncated">{{ truncated }}\n    <span class="dots" ng-show="rest.length > 0">&hellip;</span>\n    <span class="rest">{{ rest }}</span>\n</span>',expression=element.text(),interpolate=$interpolate(expression),length=attributes.truncate,element.html(template),scope.$watch(interpolate,function(text){return text=String(text),scope.truncated=text.substring(0,length),scope.rest=text.substring(length),$compile(element.contents())(scope)})}}}).directive("draggable",function(){return{"restrict":"CA","compile":function(element){return element.draggable(),function(scope,element,attrs){var config;return config=attrs.draggable,scope.$watch(config,function(options){return element.draggable(options)})}}}}).directive("logLevel",function(){return{"scope":{"logLevel":"="},"link":function(scope,element){var level;return level=scope.logLevel,element.text(level),element.addClass("label-"+level)}}}).directive("tabContentTransclude",function(){return{"link":function(scope,element){var invalidCount,updateInvalid;return updateInvalid=function(invalid){return scope.tab.invalid=invalid>0},invalidCount=function(){return element[0].querySelectorAll("input.ng-invalid,select.ng-invalid").length},scope.$watch(invalidCount,updateInvalid)}}}).directive("tabHeadingTransclude",function(){return{"link":function(scope,elm){var invalid;return invalid=function(){return scope.invalid},scope.$watch(invalid,function(isInvalid){return elm.parent().toggleClass("invalid",isInvalid)})}}}).directive("rel",function(){return{"restrict":"A","compile":function(element,attrs){return"external"===attrs.rel?element.attr("target","_blank"):void 0}}}).factory("animationFrame",function($window){var cancelRequestAnimationFrame,requestAnimationFrame;return requestAnimationFrame=$window.requestAnimationFrame||$window.mozRequestAnimationFrame||$window.webkitRequestAnimationFrame||$window.oRequestAnimationFrame||$window.msRequestAnimationFrame,cancelRequestAnimationFrame=$window.cancelRequestAnimationFrame||$window.mozCancelRequestAnimationFrame||$window.webkitCancelRequestAnimationFrame||$window.oCancelRequestAnimationFrame||$window.msCancelRequestAnimationFrame,{"request":function(fun){return requestAnimationFrame(fun)},"cancel":function(id){return cancelRequestAnimationFrame(id)},"withFallback":function(func){return("function"==typeof requestAnimationFrame?requestAnimationFrame(func):void 0)||func()}}}).factory("defer",function($browser,animationFrame){return function(fun){return $browser.defer(function(){return animationFrame.request(fun)})}})}.call(this),function(){angular.module("slug.directives.confirm",[]).directive("slugConfirm",function(){var ACTIVE_CLASS;return ACTIVE_CLASS="slug-confirm-active",{"transclude":!0,"priority":-1,"template":'<span class="slug-confirm-original" ng-transclude/>\n<span class="slug-confirm-box">\n  <a href class="slug-confirmation">Yes</a> | <a href> No</a>\n</span>',"link":function(scope,element){var confirmation;return element.addClass("slug-confirm"),confirmation=element.find(".slug-confirmation"),confirmation.bind("focusout",function(){return element.removeClass(ACTIVE_CLASS)}),element.bind("click",function(event){return element.toggleClass(ACTIVE_CLASS),event.target!==confirmation.get(0)?(event.stopImmediatePropagation(),event.preventDefault()):void 0})}}})}.call(this),function(){angular.module("slug.directives.demo_block",["slug.user_settings"]).directive("demoBlock",function(UserSettings){return{"compile":function(element,attrs){var closeLink,hidden,setting;return element.addClass("demo-block"),setting="hide_demo_block_"+attrs.demoBlock,element.hide(),hidden=UserSettings.get(setting,function(hidden){return hidden||(hidden=!1),element.toggle(!hidden)}),closeLink=angular.element('<button class="demo-block-remove" type="button">\n<i class="icon icon-remove"></i></button>'),closeLink.on("click",function(){return element.hide(),UserSettings.set(setting,!0)}),element.prepend(closeLink)}}})}.call(this),function(){angular.module("slug.directives.filter",["slug.directives"]).controller("NavigationFilterCtrl",function($scope,flash){return $scope.canEdit=function(filter){return filter&&!filter.builtin},$scope.canDelete=function(filter){return $scope.canEdit(filter)&&!!filter._id},$scope.isEditing=function(filter){var _ref;return(null!=(_ref=$scope.editing)?_ref.$filter:void 0)===filter},$scope.edit=function(filter){var _ref;return $scope.editing=angular.copy(filter),null!=(_ref=$scope.editing)?_ref.$filter=filter:void 0},$scope.update=function(filter){return filter.$save(function(){return flash.success="Filter saved",$scope.editing=null})},$scope.apply=function(filter){return $scope.edit(null),$scope.search.use(filter)},$scope["delete"]=function(filter){return filter.$delete(function(){return flash.info="Filter removed",$scope.remove(filter)})},$scope.remove=function(filter){return $scope.filters=_($scope.filters).without(filter)},$scope.clear=function(){return $scope.edit(null),$scope.search.clear()},$scope.off=function(){return $scope.search.clear()},$scope.save=function(filter){var copy;return copy=angular.copy($scope.editing),angular.extend(filter,copy),filter.$save(function(){return flash.info="Filter saved",$scope.edit(null),$scope.apply(filter)})},$scope.abort=function(filter){return filter._id||$scope.remove(filter),$scope.edit(null)},$scope.addNew=function(){var filter;return filter=$scope.newFilter([]),filter.name=null,$scope.filters.push(filter),$scope.edit(filter)}}).directive("listFilter",function($rootScope){return{"templateUrl":"/navigation/filter.html","controller":"NavigationFilterCtrl","transclude":!0,"scope":!0,"link":function(scope,element,attrs){return scope.listFilterTitle=attrs.filterTitle,$rootScope.$on("editFilter",function(event,filter){return scope.edit(filter)})}}}).directive("editFilter",function(){return{"template":'<form class="edit-form">\n  <input required focus type="text" placeholder="{{ placeholder }}"\n    ng-model="editing.name">\n</form>',"replace":!0,"transclude":!0,"restrict":"E","priority":0,"scope":!0,"link":function(scope,element,attrs){var input;return input=element.find("input"),scope.placeholder=attrs.placeholder,element.removeAttr("placeholder")}}})}.call(this),function(){angular.module("slug.directives.highlight",[]).directive("highlight",function($browser,animationFrame){var DEFAULT_THEME;return DEFAULT_THEME="default",{"scope":{"code":"=highlight","contentType":"=?highlightContentType","transform":"@highlightTransform","theme":"@highlightTheme"},"link":function(scope,element,attrs){var binding,output,theme,transform,update;return output=element.get(0),theme=scope.theme||DEFAULT_THEME,element.addClass("cm-s-"+theme),transform=function(code){switch(scope.transform){case"json":return scope.contentType="application/json",angular.toJson(code,!0);default:return code}},update=function(){return $browser.defer(function(){var code;return code=transform(scope.code),animationFrame.withFallback(function(){return CodeMirror.runMode(code,scope.contentType,output)})})},scope.code&&update(),null!=attrs.highlightRefresh?(binding=function(){return scope.code},scope.$watch(binding,update)):void 0}}})}.call(this),function(){angular.module("slug.directives.list",["ui.bootstrap.collapse","ngAnimate"]).controller("SlugListItemController",function($scope){return $scope.slugListItemToggle=function(){return $scope.isOpen=!$scope.isOpen}}).directive("slugList",function(){return{"restrict":"A","transclude":!1,"link":function(scope,element){return element.addClass("slug-list")}}}).directive("slugItem",function($location){return{"restrict":"A","controller":"SlugListItemController","transclude":!1,"link":function(scope,element,attrs){var anchor,item;return scope.$watch("isOpen",function(isOpen){return element.toggleClass("opened",!!isOpen)}),scope.isOpen=scope.$eval(attrs.slugItemExpanded),item=scope.$eval(attrs.slugItem),item&&scope.isOpen&&(anchor=angular.element("<a>",{"name":"list-item-"+item._id}),element.prepend(anchor),$location.hash("list-item-"+item._id)),element.addClass("slug-item")}}}).directive("heading",function(){return{"restrict":"E","require":"^slugItem","template":'<div class="slug-item-heading" ng-transclude></div>',"replace":!0,"transclude":!0}}).directive("toggle",function(){return{"restrict":"E","require":"^slugItem","template":'<div class="slug-item-toggle" ng-click="slugListItemToggle()"\nng-transclude></div>',"replace":!0,"transclude":!0}}).directive("actions",function(){return{"restrict":"E","require":"^slugItem","template":'<div class="slug-item-actions dropdown">\n  <action-button></action-button>\n  <ul class="group dropdown-menu slug-item-dropdown" ng-transclude></ul>\n</div>',"replace":!0,"transclude":!0,"link":function(scope){return scope.active_actions=0,scope.$on("actions.running",function(){return scope.active_actions+=1}),scope.$on("actions.finished",function(){return scope.active_actions-=1})}}}).directive("actionButton",function(){return{"restrict":"E","require":"^actions","replace":!0,"template":'<button class="action-button dropdown-toggle">\n<i class="icon icon-cog" ng-class="{\'icon-spin\': active_actions > 0 }"></i></button>'}}).directive("actionItem",function(){return{"restrict":"E","require":"^slugItem","template":'<li class="" ng-transclude></li>',"replace":!0,"transclude":!0}}).directive("action",function($compile){return{"scope":!0,"compile":function(element,attrs){var _icon,_text;return element.addClass("action"),_icon=angular.lowercase(attrs.icon),_text=attrs.text,function(scope,element){var icon,text;return icon=angular.element('<i class="icon {{ icon }}"/>'),$compile(icon)(scope),element.append(icon),scope.icon=_icon,_text?(text=angular.element("<span> {{ text }}</span>"),$compile(text)(scope),icon.append(text),scope.text=_text):void 0}}}}).directive("actionCall",function(){return{"link":function(scope,element,attrs){return element.bind("click",function(){return scope.$emit("actions.running"),scope.$eval(attrs.actionCall).then(function(){return scope.$emit("actions.finished")})})}}}).directive("details",function(){return{"restrict":"E","require":"^slugItem","template":'<div class="slug-item-details" ng-transclude></div>',"replace":!0,"transclude":!0}}).directive("detail",function(){return{"restrict":"EA","template":'<span class="detail" ng-transclude></span>',"replace":!0,"transclude":!0}}).directive("content",function(){return{"restrict":"E","require":"^slugItem","template":'<div class="slug-item-content" collapse="!isOpen" ng-transclude></div>',"replace":!0,"transclude":!0}})}.call(this),function(){angular.module("slug.directives.navigation",["slug.filters"]).controller("MiddlewareNavigationCtrl",function($scope){return $scope}).controller("ServiceNavigationCtrl",function($scope){return $scope}).directive("middlewareNavigation",function(){return{"controller":"MiddlewareNavigationCtrl","templateUrl":"/navigation/middleware.html"}}).directive("serviceNavigation",function(){return{"controller":"ServiceNavigationCtrl","templateUrl":"/navigation/service.html"}}).directive("tracesNavigation",function(){return{"controller":"TracesNavigationCtrl","templateUrl":"/navigation/traces.html"}}).directive("analyticsNavigation",function(){return{"controller":"DashboardsNavigationCtrl","templateUrl":"/navigation/analytics.html"}})}.call(this),function(){var pretty_print,syntax_highlight;pretty_print=angular.module("slug.directives.pretty_print",[]),pretty_print.directive("prettyPrint",function($sce){return{"restrict":"E","template":'<pre ng-bind-html="prettyPrintCode"/>',"replace":!0,"scope":{"object":"=value","theme":"@theme","language":"@lang"},"link":function(scope,element){var binding,callback,object,theme,update,_ref;return binding=function(){return scope.object},theme=scope.theme||"default",element.addClass("cm-s-"+theme),update=function(object){var lang,text;if(object){switch(scope.language){case"json":text=angular.toJson(object,!0),lang={"name":"javascript","json":!0};break;default:text=object}return scope.prettyPrintCode=$sce.trustAsHtml(syntax_highlight(text,lang))}},object=scope.$eval(binding),(callback=null!=object&&null!=(_ref=object.$promise)?_ref.then:void 0)?callback(update):scope.$watch(binding,update)}}}),syntax_highlight=function(text,language){var node;return null==language&&(language="null"),text?(node=document.createElement("div"),CodeMirror.runMode(text,language,node),node.innerHTML):void 0}}.call(this),function(){angular.module("slug.directives.search",[]).controller("SearchBoxCtrl",function($scope,flash){var tokens;return tokens=$scope.search.tokens,$scope.search.type="basic",$scope.saveFilter=function(){var filter;return filter=$scope.search.using_filter,filter.tokens=tokens(),filter.$save(function(){return flash.success="Filter saved"})},$scope.saveFilterAs=function(){var filter;return filter=$scope.newFilter(tokens()),filter.$save(function(){return flash.success="Filter created",$scope.filters.push(filter),$scope.search.used_filter=filter,$scope.$emit("editFilter",filter)})}}).directive("searchLoading",function(){return{"template":'<button id="search-loading"\n  class="btn btn-block btn-large btn-primary loading">\n  <i class="icon-refresh icon-spin"></i> Loading...\n</button>',"link":function(scope,element,attributes){var loading;return loading=attributes.searchLoading||"search.loading",scope.$watch(loading,function(loading){return element.toggle(!!loading)})}}}).directive("searchLoadMore",function(){return{"template":'<button ng-click="search.more()"\n  class="btn btn-block btn-large btn-primary">\n  <i class="icon-refresh icon-spin"></i>\n  <span ng-transclude></span>\n</button>',"transclude":!0,"link":function(scope,element){return scope.$watch("search.canLoadMore()",function(canLoadMore){return element.toggle(!!canLoadMore)})}}}).directive("searchBox",function(){return{"templateUrl":"/search/search_box.html","controller":"SearchBoxCtrl","replace":!0,"restrict":"EA"}}).controller("ControlBoxCtrl",function($scope,TokenHeuristics){return $scope.selected=[],$scope.toggleAllItems=function(){return 0===$scope.selected.length?$scope.selected=$scope.search.results:$scope.deselect()},$scope.hasSelected=function(){return $scope.selected.length>0},$scope.deselect=function(items){var _ref;return $scope.selected=null!=items?(_ref=_($scope.selected)).without.apply(_ref,items):[]},$scope.highlightItems=function(items){var item,starred,toggle,_i,_len;for(starred=_(items).any(function(item){return item.starred}),toggle=starred?"$unstar":"$star",_i=0,_len=items.length;_len>_i;_i++)item=items[_i],item[toggle]();return $scope.deselect()},$scope.filterItems=function(items){var heuristics;return heuristics=new TokenHeuristics(items),heuristics.singular("level","channel","req.method","res.status","req.host","req.uri"),$scope.suggestions=heuristics.suggestions(),$scope.deselect()},$scope.trashItems=function(items){var item,_i,_len;for(_i=0,_len=items.length;_len>_i;_i++)item=items[_i],item.$delete(function(item){return $scope.search.remove(item)});return $scope.deselect(items)},$scope.toggleItem=function(item){return item?$scope.selected.indexOf(item)>=0?$scope.selected=_($scope.selected).without(item):$scope.selected.push(item):void 0}}).directive("controlBox",function(){return{"templateUrl":"/search/control_box.html","controller":"ControlBoxCtrl","replace":!0,"restrict":"EA"}}).directive("loadMore",function(){return{"restrict":"E","replace":!0,"transclude":!0,"template":'<div class="btn-toolbar">\n  <button id="load-more" ng-show="search.has_more > 0"\n    ng-click="search.refresh()" class="btn btn-block btn-large btn-primary">\n    <i class="icon-refresh"></i> <span ng-transclude/>\n  </button>\n </div>'}}).directive("toggleItem",function(){return{"replace":!0,"template":'<input type="checkbox" class="toggle-item" ng-model="checked"\nng-change="toggleItem(item)" />',"scope":!0,"link":function(scope,element,attributes){return scope.$watch("selected.indexOf(item) >= 0",function(selected){return scope.checked=selected,element.addClass("slug-item-check")}),scope.$watch(attributes.toggleItem,function(item){return scope.item=item})}}}).directive("toggleAllItems",function(){return{"replace":!0,"template":'<input type="checkbox" class="toggle-all-items"\n  tooltip="Select/Deselect All" />',"link":function(scope,element){var areSame,input;return input=element.filter("input"),areSame=function(){return scope.selected===scope.search.results},input.bind("click",function(){return scope.toggleAllItems(),input.prop("checked",areSame())}),scope.$watch(areSame,function(same){return input.prop("checked",same)})}}})}.call(this),function(){var service_submenu;angular.module("slug.service_submenu.service",[]).constant("ServiceSubmenu",service_submenu={"service":null,"show":!0,"active":!1,"isSelected":function(service){var _ref;return(null!=(_ref=service_submenu.service)?_ref._id:void 0)===(null!=service?service._id:void 0)},"use":function(service){return service_submenu.service=service},"update":function(service){return service_submenu.isSelected(service)?service_submenu.use(service):void 0}}),angular.module("slug.service_submenu",["slug.service","slug.utils","slug.service_submenu.service"]).factory("ActiveDocsCheck",function($http,$state){return function(service_id){return null==service_id&&(service_id=$state.params.serviceId),service_id?$http({"method":"GET","url":"/api/services/"+service_id+"/docs"}):void 0}}).controller("ServiceSubmenuCtrl",function($scope,$rootScope,$state,$loop,Service,ServiceSubmenu,ActiveDocsCheck,UserSettings){return $scope.submenu=ServiceSubmenu,$scope.config=UserSettings,$scope.$watch(function(){return ServiceSubmenu.service},function(service){return $scope.service_navigation=(null!=service?service._id:void 0)?"/navigation/service.html":"/navigation/all_services.html"}),$rootScope.$on("serviceReset",function(){return ServiceSubmenu.use(null)}),$rootScope.$on("serviceUpdated",function(event,service){return ServiceSubmenu.services=Service.query(function(){return ServiceSubmenu.update(service)})}),$scope.selectService=function(service){var params,root,scoped,state;return service?(params={"serviceId":service._id},$state.includes("service")?$state.transitionTo($state.current.name,params):(scoped=$state.get("service."+$state.current.name),scoped?$state.transitionTo(scoped,params):$state.transitionTo("service.traces",params))):(ServiceSubmenu.use(service),root=$state.current.name.replace("service.",""),state=$state.get(root),void $state.transitionTo(state&&"service"!==state.parent?state:"services"))}}).directive("serviceSubmenu",function(){return{"templateUrl":"/services/_submenu.html","controller":"ServiceSubmenuCtrl","replace":!0}})}.call(this),function(){var __bind=function(fn,me){return function(){return fn.apply(me,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};angular.module("slug.directives.token_input",["slug.directives"]).factory("KEY_CODES",function(){return{"LEFT_ARROW":37,"RIGHT_ARROW":39,"ENTER":13,"BACKSPACE":8,"DELETE":46}}).factory("TokenCollection",function(){var TokenCollection;return TokenCollection=function(){function TokenCollection(tokens){this.tokens=tokens}return TokenCollection.prototype.has=function(token){var existing,string,_i,_len,_ref;for(string=token.toString(),_ref=this.tokens,_i=0,_len=_ref.length;_len>_i;_i++)if(existing=_ref[_i],existing.toString()===string)return existing;return!1},TokenCollection}()}).factory("TokenFormat",function(){var AVAILABLE_OPERATORS,key,ops;return AVAILABLE_OPERATORS=[">=",">","<","<=","=","="],ops=AVAILABLE_OPERATORS.join("|"),key="[^\\s=><]+",new RegExp("("+key+")\\s*("+ops+")\\s*("+key+")")}).factory("Token",function(TokenFormat){var Token;return Token=function(){function Token(attributes){null==attributes&&(attributes={}),angular.extend(this,attributes),delete this.new_token}return Token.prototype.pattern=TokenFormat.source,Token.prototype.toString=function(){return[this.key,this.op,this.value].join(" ")},Token}()}).factory("NewToken",function(Token,TokenFormat){var NewToken;return NewToken=function(_super){function NewToken(attributes){null==attributes&&(attributes={}),this.reset=__bind(this.reset,this),this.parse=__bind(this.parse,this),this.new_token=!0,NewToken.__super__.constructor.call(this,attributes)}return __extends(NewToken,_super),NewToken.prototype.parse=function(){var key,match,op,token,value,_,_ref;return(match=null!=(_ref=this.input)?_ref.match(TokenFormat):void 0)?(_=match[0],key=match[1],op=match[2],value=match[3],token=new Token({"key":key,"op":op,"value":value})):void console.warn(""+this.input+" does not match "+this.pattern)},NewToken.prototype.reset=function(){return this.input=null},NewToken}(Token)}).controller("TokenSuggestionsController",function($scope){return $scope.removeToken=function(token){return $scope.suggestions=_($scope.suggestions).without(token)},$scope.toggleToken=function(token){return token.active=!0,$scope.tokens.push(token),$scope.removeToken(token)}}).controller("TokenInputController",function($scope,NewToken,Token,flash){return $scope.tokens||($scope.tokens=[]),$scope.new_token=new NewToken,$scope.addToken=function(new_token){var token;return(token=new_token.parse())?($scope.tokens.push(token),token.active=!0,new_token.reset()):flash.warning=""+new_token.input+" is not valid filter syntax"},$scope.selectPrev=function(){var index;return index=null!=$scope.selected?$scope.selected:$scope.tokens.length,index=index>0?index-1:0,$scope.select(index)},$scope.selectNext=function(){var index;return index=$scope.selected,index=null!=index?index+1:$scope.tokens.length,$scope.select(index)},$scope.select=function(index){var max;return max=$scope.tokens.length,index=index>max?max:index,index=0>index?0:index,$scope.selected=index},$scope.removeToken=function(token){return $scope.tokens=_($scope.tokens).without(token)},$scope.toggleToken=function(token){return token.active=!token.active},$scope["delete"]=function(){var selected;return selected=$scope.tokens[$scope.selected],$scope.removeToken(selected),!!selected},$scope.edit=function(token){var index,previous;return previous=$scope.editing,index=$scope.tokens.indexOf(token),$scope.editing=null!=index&&token?{"index":index,"token":token,"value":token.toString()}:null},$scope.updateToken=function(token){var new_token,update;return new_token=new NewToken({"input":$scope.editing.value}),(update=new_token.parse())?(angular.extend(token,update),$scope.editing=null):void 0}}).directive("tokenInput",function(){return{"restrict":"E","replace":!0,"transclude":!0,"controller":"TokenInputController","scope":{"tokens":"=tokens"},"template":'<ul class="token-active">\n  <token ng-repeat="token in tokens"></token>\n  <new-token></new-token>\n  <a class="help" tooltip="Required format is: name = value">\n    <i class="icon-help"></i>\n  </a>\n</ul>',"link":function(scope){return scope}}}).directive("tokenSuggestions",function(TokenCollection){return{"restrict":"E","scope":{"tokens":"=tokens","suggestions":"=suggestions"},"controller":"TokenSuggestionsController","replace":!0,"transclude":!0,"template":'<ul class="token-suggestions"\n  ng-class="{empty: suggestions && unique_suggestions.length == 0 }">\n  <token ng-repeat="token in suggestions"></token>\n  <li class="no-suggestions">\n    We don\'t have any more filter suggestions.\n  </li>\n</ul>',"link":function(scope,element){return element.addClass("suggestions"),scope.$watch("suggestions",function(suggestions){var tokens;return tokens=new TokenCollection(scope.tokens),scope.unique_suggestions=_(suggestions).filter(function(suggestion){return!(suggestion.disabled=tokens.has(suggestion))})}),element.on("click",".show-mode",function(event){var token;return token=$(event.target).scope().$eval("token"),token.disabled?!1:scope.toggleToken(token)})}}}).directive("token",function(KEY_CODES,debug){return{"restrict":"E","replace":!0,"transclude":!0,"template":'<li class="token"\n    ng-class="{selected: $index === selected,\n      suggested: token.suggestion, active: token.active,\n      editing: $index === editing.index, disabled: token.disabled}">\n  <a href class="toggle"\n    ng-click="toggleToken(token)">\n    <i class="icon" ng-class="{\'icon-check\': token.active,\n      \'icon-check-empty\': !token.active }">\n    </i>\n  </a>\n  <span class="show-mode" ng-click="edit(token)"\n    ng-show="$index !== editing.index">\n    <span class="token-key">{{ token.key }}</span>\n    <span class="token-operator">{{ token.op }}</span>\n    <span class="token-value">{{ token.value }}</span>\n  </span>\n  <form class="edit-mode" ng-submit=\'updateToken(token)\'\n    ng-if="$index === editing.index" class="token-edit">\n    <input type="text" pattern=\'{{ token.pattern }}\'\n      ng-model="editing.value" size="auto">\n  </form>\n\n  <a href class="delete" ng-click="removeToken(token)">\n    <i class="icon icon-trash"></i>\n  </a>\n</li>',"link":function(scope,element){return element.on("keyup","input",function(event){switch(event.keyCode){case KEY_CODES.ENTER:debug(function(){return console.log("ENTER pressed, event: %O",event.keyCode,event)})}return!1})}}}).directive("size",function(){return{"restrict":"A","require":"ngModel","priority":1e3,"link":function(scope,element,attrs,ngModel){var $shadow,FREE_SPACE;return FREE_SPACE=16,element.is("input")&&"auto"===attrs.size?($shadow=angular.element("<span/>").css({"font":element.css("font"),"position":"absolute","visibility":"hidden","zIndex":-1,"whiteSpace":"pre"}),$shadow.insertAfter(element),scope.$on("$destroy",function(){return $shadow.remove()}),element.on("keyup focus focusin blur resize",function(){return $shadow.text(ngModel.$viewValue),element.width($shadow.width()+FREE_SPACE)})):void 0}}}).directive("newToken",function(KEY_CODES,debug){return{"restrict":"E","scope":!0,"replace":!0,"template":'<li class="token new">\n  <form class="edit-mode show-mode" nam="form" ng-submit="addToken(token)">\n    <input placeholder="New filter" type="text" size="auto"\n      pattern=\'{{ token.pattern }}\' required ng-model="token.input" />\n    <button class="save-token btn-link">\n      <i class="icon icon-plus"></i>\n    </button>\n  </form>\n</li>',"link":function(scope,element){var $el,handleEmptyToken,handleToken;return $el=$(element),scope.token=scope.new_token,handleToken=function(code){switch(code){case KEY_CODES.ENTER:return scope.addToken(scope.token),element.children().children().css({"width":"auto"});default:return scope.select(null)}},handleEmptyToken=function(code){switch(code){case KEY_CODES.LEFT_ARROW:return scope.selectPrev();case KEY_CODES.RIGHT_ARROW:return scope.selectNext();case KEY_CODES.DELETE:return scope["delete"]();case KEY_CODES.BACKSPACE:if(scope["delete"]())return scope.selectPrev();break;case KEY_CODES.ENTER:return scope.$emit("search");default:return scope.select(null),debug(function(){return console.log("keycode",event.keyCode)})}},$el.on("focusin",function(){return scope.$apply(function(){return scope.edit(null)})}),$el.on("keydown",function(event){var code,length,_ref;switch(code=event.keyCode,length=(null!=(_ref=event.target.value)?_ref.length:void 0)>0,code){case KEY_CODES.ENTER:if(!(length>0))return!1}}),$el.on("keyup",function(event){var code;return code=event.keyCode,scope.$apply(function(){var _ref;return(null!=(_ref=event.target.value)?_ref.length:void 0)>0?handleToken(code):handleEmptyToken(code)})})}}})}.call(this),function(){angular.module("slug.filters",[]).filter("moment",function(){return function(time,format){return null==format&&(format="LLLL"),moment.utc(time).format(format)}}).filter("unix",function(){return function(input){return moment.unix(input).valueOf()}}).filter("truncate",function(){return function(input,length){return input?(input=String(input),!input||(null!=input?input.length:void 0)<=length?input:input.substring(0,length)+"..."):void 0}}).filter("ms",function(){return function(input){return input?""+Math.round(1e3*input)+" ms":"cached"}}).filter("status",function(){return function(input){switch(!1){case!(300>input&&input>=100):return"success";case!(400>input&&input>=300):return"redirect";case!(500>input&&input>=400):return"client-error";case!(600>input&&input>=500):return"server-error";default:return"unknown"}}})}.call(this),function(){angular.module("slug.analytics",["angulartics","angulartics.segment.io"]).factory("errorception",function($window){return function(error){var _ref,_ref1;return null!=(_ref=$window._errs)&&(_ref.allow||(_ref.allow=function(){return-1===$window.navigator.userAgent.indexOf("Conkeror")})),"localhost"!==$window.location.hostname&&null!=(_ref1=$window._errs)?_ref1.push(error):void 0}}).run(function($analytics,$rootScope,$location,$window){var host,service,user,_ref,_ref1;return $analytics.settings.pageTracking.autoTrackFirstPage=!1,$rootScope.$on("$stateChangeSuccess",function(){return $analytics.settings.pageTracking.autoTrackVirtualPages?$analytics.pageTrack($location.path()):void 0}),"localhost"===$location.host()?($analytics.pageTrack=function(page){return console.log("$analytics.pageTrack("+page+")")},$analytics.eventTrack=function(event,properties){return console.log("$analytics.eventTrack("+event+", "+properties+")")}):(_ref=$location.host().match(/^(\w+\-)?(\w+)/),host=_ref[0],service=_ref[1],user=_ref[2],null!=(_ref1=$window.analytics)?_ref1.identify(user,{"username":user}):void 0)}),angular.mock&&angular.module("ngMock").provider({"$analytics":{"$get":function(){return{"eventTrack":function(){},"pageTrack":function(){},"settings":{"pageTracking":{}}}}}})}.call(this),function(){angular.module("slug.documentation",["ngResource"]).directive("docsRef",function(Documentation){return{"scope":{"docsRef":"@"},"link":function(scope,element){return element.attr("href",Documentation[scope.docsRef])}}}).factory("Documentation",function(){var host;return host="http://docs.apitools.com",{"home":host+"/docs/","middlewares":host+"/docs/pipeline/","pipeline":host+"/docs/pipeline/","tour":host+"/docs/tour/","getting_started":host+"/docs/using-services/ ","notifications":host+"/docs/notifications/","active_docs":host+"/docs/active-docs/","analytics":host+"/docs/tour/#service-analytics","filters":host+"/docs/filters/","traces":host+"/docs/"}})}.call(this),function(){var RickshawHover;RickshawHover=Rickshaw.Class.create(Rickshaw.Graph.HoverDetail,{"render":function(args){var $element,$label,d,dot,graph,i,label_height,leftAlignError,line,points,rightAlignError,_i,_len;
for($element=$(this.element),graph=this.graph,points=args.detail.sort(function(a,b){return a.order-b.order}),$label=$("<div/>",{"class":"super-label"}),i=_i=0,_len=points.length;_len>_i;i=++_i)d=points[i],d.formattedYValue&&$.isNumeric(d.value.y)&&(0===i&&$label.append($("<div/>",{"class":"title"}).html(d.formattedXValue)),line=$("<div/>").append($("<div/>",{"class":"swatch"}).css("background-color",d.series.color)).append($("<span/>").html(d.name+": ")).append($("<span/>",{"class":"value"}).html(d.formattedYValue)),$label.append(line),dot=$("<div/>",{"class":"dot active"}).css("border-color",d.series.color).css("top",graph.y(d.value.y0+d.value.y)+"px"),$element.append(dot));return $label.addClass("left"),$element.append($label),this.show(),leftAlignError=this._calcLayoutError([$label[0]]),leftAlignError>0&&($label.removeClass("left").addClass("right"),rightAlignError=this._calcLayoutError([$label[0]]),rightAlignError>leftAlignError&&$label.removeClass("right").addClass("left")),label_height=$label.height(),$label.css("top",Math.max(0,Math.min(args.mouseY-label_height/2,graph.height-label_height-20)))}}),angular.module("slug.stats",["slug.utils","ngResource","slug.utils"]).directive("rickshaw",function(RickshawSeries,$window,$compile,defer){return{"restrict":"A","template":"<div class='graph'></div>","link":function(scope,element,attrs){var dimensions,getAvailableDimensions,graph,graph_height,graph_width,hoverDetail,lastDimensions,oldDomain,parent,renderer,resize,series,strokeWidth,triggerUpdate,window,xAxis,yAxis;return series=[{"data":[{"x":0,"y":0}]}],parent=element.parent(),graph_height=attrs.rickshawHeight,graph_width=attrs.rickshawWidth,renderer=attrs.rickshawRenderer||"line",strokeWidth=attrs.rickshawStrokeWidth||1,graph=new Rickshaw.Graph({"height":graph_height,"width":graph_width,"renderer":renderer,"strokeWidth":strokeWidth,"element":element.find(".graph")[0],"interpolation":"linear","stroke":!0,"series":series,"min":0,"padding":{"top":.1,"bottom":.1}}),oldDomain=graph.renderer.domain,graph.renderer.domain=function(data){var domain;return domain=oldDomain.call(this,data),domain.y[0]===domain.y[1]&&(domain.y[1]+=12),domain},xAxis=new Rickshaw.Graph.Axis.Time({"graph":graph,"timeFixture":new Rickshaw.Fixtures.Time}),xAxis.render(),yAxis=new Rickshaw.Graph.Axis.Y({"graph":graph,"tickFormat":Rickshaw.Fixtures.Number.formatKMBT}),yAxis.render(),hoverDetail=new RickshawHover({"graph":graph,"xFormatter":function(x){return d3.time.format("%A, %b %e, %H:%M UTC")(new Date(1e3*x))}}),lastDimensions=null,dimensions=null,resize=function(){return lastDimensions=dimensions,dimensions=getAvailableDimensions(),angular.equals(dimensions,lastDimensions)?void 0:graph.configure({"height":dimensions.height,"width":dimensions.width})},getAvailableDimensions=function(){var newHeight,newWidth;return parent.children().hide(),newHeight=graph_height||parent.height()-(element.outerHeight(!0)-element.height()),newWidth=graph_width||parent.width()-(element.outerWidth(!0)-element.width()),parent.children().show(),{"height":newHeight,"width":newWidth}},graph.onUpdate(function(){return defer(function(){return resize()})}),graph.onConfigure(function(){return graph.update()}),triggerUpdate=_.debounce(function(){return graph.update()},50),window=angular.element($window),window.bind("resize",triggerUpdate),scope.$on("$destroy",function(){return window.unbind("resize",triggerUpdate)}),graph.render(),scope.$watch(attrs.rickshaw,function(analytics){var i,item,newSeries,_i,_len;if(newSeries=RickshawSeries(analytics,renderer,attrs.rickshawColor)){for(i=_i=0,_len=newSeries.length;_len>_i;i=++_i)item=newSeries[i],series[i]=item;for(;series.length>newSeries.length;)series.pop();return graph.update()}})}}}).directive("rickshawMaximizer",function($modal){return{"restrict":"A","template":"<i class='icon icon-resize-full rickshaw-maximizer' title='Maximize'></i>","link":function(scope,element){var graph;return graph=element.siblings("[rickshaw]"),element.on("click",function(){var modal;return modal=$modal.open({"templateUrl":"/stats/maximized.html","controller":"MaximizedStatsCtrl","scope":scope,"backdrop":"static","windowClass":"modal modal-full-graph modal-fill-flex modal-slug","resolve":{"analytics":function(){return graph.attr("rickshaw")},"color":function(){return graph.attr("rickshaw-color")},"renderer":function(){return graph.attr("rickshaw-renderer")||"line"},"strokeWidth":function(){return graph.attr("rickshaw-stroke-width")||1}}})})}}}).controller("MaximizedStatsCtrl",function($scope,$timeout,analytics,color,renderer,strokeWidth){return $scope.close=$scope.$close,$scope.color=color,$scope.renderer=renderer,$scope.strokeWidth=strokeWidth,$scope.$watch(analytics,function(analytics){return $scope.analytics=analytics})}).factory("RickshawSeries",function(RickshawColor){return function(analytics,renderer,color){var data,i,name,normalized_query,resolution,serie,serie_color,start,stroke_color,value,_i,_len,_ref,_ref1,_results;if(!analytics)return null;for(normalized_query=analytics.normalized_query,resolution=normalized_query.range.granularity,start=normalized_query.range.start,_ref=analytics.results,_results=[],_i=0,_len=_ref.length;_len>_i;_i++)serie=_ref[_i],0===serie.data[serie.data.length-1]&&(serie.data[serie.data.length-1]=serie.data[serie.data.length-2]),data=function(){var _j,_len1,_ref1,_results1;for(_ref1=serie.data,_results1=[],i=_j=0,_len1=_ref1.length;_len1>_j;i=++_j)value=_ref1[i],_results1.push({"x":start+i*resolution,"y":value});return _results1}(),name=serie.metric,_ref1=RickshawColor(name,color,renderer),serie_color=_ref1[0],stroke_color=_ref1[1],_results.push({"color":serie_color,"stroke":stroke_color,"data":data,"name":name});return _results}}).factory("StringToColor",function(){return function(str){var color,hash,i,_i,_ref;for(hash=0,i=_i=0,_ref=str.length-1;_ref>=_i;i=_i+=1)hash=str.charCodeAt(i)+((hash<<3)-hash);return color=Math.abs(hash).toString(16).substring(0,6),"#"+"000000".substring(0,6-color.length)+color}}).factory("RickshawColor",function(StringToColor){return function(serie_name,color,renderer){var serie_color,stroke_color;return serie_color=color||StringToColor(serie_name),stroke_color=serie_color,"area"===renderer&&(serie_color=d3.interpolateRgb(serie_color,"white")(.7)),[serie_color,stroke_color]}}).factory("ServiceStats",function($resource,$state){return $resource("/api/services/:serviceId/stats/analytics",{"serviceId":function(){return $state.params.serviceId}})}).factory("Stats",function($resource){return $resource("/api/stats/analytics",{})}).factory("LoadChart",function($q,ServiceStats,jsonify){var group_by,query,range;return group_by=function(group){return[!!group.methods,!!group.paths,!!group.statuses,!!group.service]},range=function(query){var rng;return rng=query.range,rng=angular.copy(rng[rng.type]),angular.extend(rng,{"granularity":query.range.granularity})},query=function(query){var enabled,methods,metric,metrics,name,names,pluck,projections;return pluck=function(array){return _.isArray(array)?_(array).pluck("value"):array||[]},methods=query.methods?_(query.methods).keys():[],0===methods.length&&(methods="*"),metrics=[query.paths],"status"===query.metric&&metrics.push(query.statuses),metrics=function(){var _i,_len,_results;for(_results=[],_i=0,_len=metrics.length;_len>_i;_i++)metric=metrics[_i],names=pluck(metric),_.isArray(names)&&0===names.length&&(names="*"),_results.push(names);return _results}(),metrics.unshift(methods),projections=function(){var _ref,_results;_ref=query.projections,_results=[];for(name in _ref)enabled=_ref[name],_results.push(enabled?name:void 0);return _results}(),{"query":jsonify({"metrics":metrics,"projections":_.filter(projections,_.identity),"range":range(query),"metric":query.metric,"group_by":group_by(query.group_by||{})})}},function(chart,resource){var deferred,promise,stats;return null==resource&&(resource=ServiceStats),deferred=$q.defer(),promise=deferred.promise,chart?(stats=query(chart.query),resource.get(stats).$promise):(deferred.reject("Missing chart"),promise)}})}.call(this),function(){angular.module("slug.user_settings",["ngResource"]).factory("UserSettings",function(StoredUserSettings,$q){var cache,deferred,reject,resolve,saveCache,settings;return deferred=$q.defer(),resolve=function(){return deferred.resolve(settings)},reject=function(reason){return deferred.reject(reason)},cache=StoredUserSettings.get(resolve,reject),saveCache=function(){return deferred=$q.defer(),settings.$promise=deferred.promise,cache.$save(resolve,reject)},settings={"$promise":deferred.promise,"get":function(property,callback){return callback?cache.$promise.then(function(cache){return callback(cache[property])}):cache[property]},"extend":function(object){return angular.extend(cache,object),saveCache()},"set":function(property,value){return cache[property]=value,saveCache()},"raw":cache,"reset_settings":function(){return deferred=$q.defer(),settings.$promise=deferred.promise,cache.$delete(function(){return cache=StoredUserSettings.get(reject,resolve)})}}}).factory("StoredUserSettings",function($resource){return $resource("/api/config")})}.call(this),function(){var __slice=[].slice;angular.module("slug.utils",[]).factory("deepMerge",function(){return function(){var objects;return objects=1<=arguments.length?__slice.call(arguments,0):[],$.extend.apply($,[!0].concat(__slice.call(objects)))}}).factory("debugMode",function($location){return function(){return"debug"===$location.hash()}}).factory("debug",function(debugMode){return function(statement){return debugMode()?statement():void 0}}).factory("JSON",function($window){return $window.JSON}).factory("jsonify",function(JSON){return JSON.stringify}).factory("$loop",function($timeout){return function($scope,fn,interval){var $loop;return null==interval&&(interval=1e3),$loop={"interval":interval,"run":function(){var args;return args=1<=arguments.length?__slice.call(arguments,0):[],fn.apply(null,[$loop].concat(__slice.call(args)))},"schedule":function(wait){return null==wait&&(wait=$loop.interval),$loop.last_timeout=$timeout($loop.run,wait)},"listen":function($scope){return $scope.$on("$destroy",$loop.destroy)},"destroy":function(){return $timeout.cancel($loop.last_timeout)}},$loop.listen($scope),$loop.run(),$loop}})}.call(this),function(){angular.module("slug.services",["ngResource","slug.github","slug.search"]).factory("Middleware",function($resource){return $resource("/api/middlewares/:uuid",{"uuid":"@uuid"})}).factory("toArray",function(){return function(object){return _.isArray(object)?object:[object]}}).factory("uuid",function(){return function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r,v;return r=16*Math.random()|0,v="x"===c?r:3&r|8,v.toString(16)})}})}.call(this),function(){angular.module("slug.services.brain",[]).factory("Brain",function($http){var brain;return brain={"$promise":$http({"method":"GET","url":"/api/brain"})},brain.$promise.success(function(data){return brain.host=data.host}),brain}).factory("OnPremise",function($http){return{"register":function(uuid){return $http.post("/api/brain/register",{"uuid":uuid})},"link":function(key){return $http.post("/api/brain/link",{"key":key})},"unlink":function(){return $http.post("/api/brain/unlink",{})}}})}.call(this),function(){angular.module("slug.services.filters",["ngResource"]).factory("TracesFilter",function($resource){return $resource("/api/filters/traces/:id",{"id":"@_id"})}).factory("AnalyticsFilter",function($resource){var AnalyticsFilter;return AnalyticsFilter=$resource("/api/filters/analytics/:id",{"id":"@_id"}),angular.extend(AnalyticsFilter.prototype,{"query":function(){var metrics,projections,query;return projections=this.projections.map(function(p){return p.name}),metrics=[this.methods,this.paths,this.metrics].map(function(m){var values;switch(values=m.map(function(v){return v.name}),values.length){case 0:return"*";case 1:return values[0];default:return values}}),query={"range":this.range,"metrics":metrics,"projections":projections},JSON.stringify(query)}}),AnalyticsFilter})}.call(this),function(){var GitHub,GitHubIntegration,GitHubMessages,TokenHandler,__bind=function(fn,me){return function(){return fn.apply(me,arguments)}};TokenHandler=function(){function TokenHandler(){this.params=__bind(this.params,this),this.get=__bind(this.get,this),this.set=__bind(this.set,this),this.token=null}return TokenHandler.prototype.set=function(token){return this.token=token},TokenHandler.prototype.get=function(){return this.token},TokenHandler.prototype.params=function(params){return angular.extend({"access_token":this.get},params||{})},TokenHandler}(),GitHubIntegration=function(){function GitHubIntegration(protocol,host){this.redirect_uri="http://localhost:8089/auth/"+protocol+"/"+host,this.client_id="75a7ae9e68e3fd530b9a",this.url="https://github.com/login/oauth/authorize? client_id="+this.client_id+"&redirect_uri="+this.redirect_uri}return GitHubIntegration}(),GitHub=function(){function GitHub(){}return GitHub.prototype.repoSuggestion=function(spec){var param;return param=spec.name.replace(/[^\w]+|[\s]+/g,"-"),param.toLowerCase()},GitHub}(),GitHubMessages=function(){function GitHubMessages(spec,github){this.github=github,this.spec=angular.copy(spec),this.code=this.spec.code,this.spec.code=this.github.repo+".lua",this.should={},this.messages=[]}return GitHubMessages.prototype.reset=function(){return this.should={},this.messages=[]},GitHubMessages.prototype.isValid=function(){return _(this.messages).all(function(msg){return msg.confirm?msg.confirmed:!0})},GitHubMessages.prototype.highlight=function(message){var code,needle,owner,repo,strong;return strong=function(str){return"<strong>"+str+"</strong>"},needle=/{{\s*([^\}\s]+)\s*}}/g,owner=this.github.owner,repo=this.github.repo,code=this.spec.code,message.replace(needle,function(match,key){switch(key){case"owner/repo":return strong(""+owner+"/"+repo);case"visibility":return strong("public");case"spec":return strong("brainslug.json");case"code":return strong(code);default:throw Error("Unknown key: "+key)}})},GitHubMessages.prototype.add=function(msg,options){var message;return null==options&&(options={}),message=angular.copy(options),message.text=this.highlight(msg),this.messages.push(message)},GitHubMessages.prototype.repo_exists=function(){return this.add("I'm aware that {{owner/repo}} already exists as {{visibility}} repository",{"level":"warning","confirm":!0})},GitHubMessages.prototype.repo_missing=function(){return this.add("{{visibility}} repository {{owner/repo}} will be created",{"level":"notify"})},GitHubMessages.prototype.push_spec=function(){return this.add("We will push {{spec}} middleware specification",{"level":"info"})},GitHubMessages.prototype.push_code=function(){return this.add("We will push {{code}} middleware code",{"level":"info"})},GitHubMessages.prototype.override_spec=function(){return this.add("I'm aware that {{owner/repo}} already contains different middleware spec",{"level":"error","confirm":!0})},GitHubMessages.prototype.override_code=function(){return this.add("I'm aware that {{owner/repo}} already contains different middleware code",{"level":"warning","confirm":!0})},GitHubMessages}(),angular.module("slug.github",["ngResource"]).factory("GitHub",function(GitHubToken,GitHubIntegration){var gh;return gh=new GitHub,gh.token=GitHubToken,gh.integration=GitHubIntegration,gh}).factory("GitHubToken",function(){return new TokenHandler}).factory("GitHubMessages",function(){return GitHubMessages}).factory("GitHubIntegration",function($location){return new GitHubIntegration($location.protocol(),window.location.host)}).factory("GitHubSpec",function($resource,GitHubToken){return $resource("/api/test/test",GitHubToken.params())}).factory("GitHubFile",function($resource,GitHubToken){return $resource("https://api.github.com/repos/:owner/:repo/contents/:path",GitHubToken.params(),{"save":{"method":"PUT"}})}).factory("GitHubRepo",function($resource,GitHubToken){return $resource("https://api.github.com/:scope/:owner/:repo",GitHubToken.params({"scope":"repos"}),{"create":{"method":"POST","params":{"scope":"user","owner":"repos"}}})}).factory("GitHubSearchCode",function($resource,GitHubToken){return $resource("https://api.github.com/search/code",GitHubToken.params(),{"get":{"method":"GET","headers":{"Accept":"application/vnd.github.preview"}}})}).factory("GitHubValidator",function($q,GitHubFile,GitHubRepo){return function(messages){var code_exists,code_missing,d,defer_code,defer_repo,defer_spec,defers,github,params,repo_exists,repo_missing,spec,spec_exists,spec_missing,_;return defers=function(){var _i,_results;for(_results=[],_=_i=1;3>=_i;_=++_i)_results.push($q.defer());return _results}(),defer_repo=defers[0],defer_spec=defers[1],defer_code=defers[2],spec=messages.spec,github=messages.github,params=function(params){var gh;return null==params&&(params={}),gh={"owner":github.owner,"repo":github.repo},angular.extend(params,gh)},code_exists=function(c){return messages.override_code(c),messages.should.update_code=c,defer_code.resolve("code exists")},code_missing=function(){return messages.push_code(),defer_code.resolve("code missing")},spec_exists=function(s){return messages.override_spec(s),messages.should.update_spec=s,defer_spec.resolve("spec exists"),GitHubFile.get(params({"path":spec.code}),code_exists,code_missing)},spec_missing=function(){return messages.push_spec(),defer_spec.resolve("spec missing"),GitHubFile.get(params({"path":spec.code}),code_exists,code_missing)},repo_exists=function(){return messages.repo_exists(),defer_repo.resolve("repo exists"),GitHubFile.get(params({"path":"brainslug.json"}),spec_exists,spec_missing)},repo_missing=function(){var d,_i,_len,_results;for(messages.should.create_repo=!0,messages.repo_missing(),messages.push_spec(),messages.push_code(),_results=[],_i=0,_len=defers.length;_len>_i;_i++)d=defers[_i],_results.push(d.resolve("repo missing"));return _results},GitHubRepo.get(github,repo_exists,repo_missing),$q.all(function(){var _i,_len,_results;for(_results=[],_i=0,_len=defers.length;_len>_i;_i++)d=defers[_i],_results.push(d.promise);return _results}())}}).factory("GitHubIntegrator",function($q,GitHubFile,GitHubRepo){return function(messages){var code,code_failed,code_updated,create_code,create_spec,d,defer_code,defer_repo,defer_spec,defers,do_code,do_spec,encode,github,params,repo_created,repo_failed,should,spec,spec_failed,spec_updated,update_code,update_spec,_;return should=messages.should,spec=messages.spec,code=messages.code,console.log(should),github={"owner":messages.github.owner,"repo":messages.github.repo},defers=function(){var _i,_results;for(_results=[],_=_i=1;3>=_i;_=++_i)_results.push($q.defer());return _results}(),defer_repo=defers[0],defer_spec=defers[1],defer_code=defers[2],params=function(params){return angular.extend(params,github)},messages.reset(),do_spec=function(){var previous;return(previous=should.update_spec)?update_spec(previous):create_spec()},do_code=function(){var previous;return(previous=should.update_code)?update_code(previous):create_code()},encode=function(object){return Base64.encode(angular.toJson(object,!0))},spec_updated=function(){return console.log("spec updated"),defer_spec.resolve("spec updated"),do_code()},code_updated=function(){return console.log("code updated"),defer_code.resolve("code updated")},repo_created=function(){return console.log("repo created"),defer_repo.resolve("repo created"),do_spec()},repo_failed=function(){return console.log("repo failed"),defer_repo.reject("repo failed")},code_failed=function(){return console.log("code failed"),defer_code.reject("code failed")},spec_failed=function(){return console.log("spec failed"),defer_spec.reject("spec failed")},create_spec=function(){return GitHubFile.save(params({"path":"brainslug.json"}),{"message":"Create middleware spec","content":encode(spec)},spec_updated,spec_failed)},update_spec=function(previous){return GitHubFile.save(params({"path":"brainslug.json"}),{"sha":previous.sha,"message":"Update middleware spec","content":encode(spec)},spec_updated,spec_failed)},create_code=function(){return GitHubFile.save(params({"path":spec.code}),{"message":"Create middleware code","content":encode(code)},code_updated,code_failed)},update_code=function(previous){return GitHubFile.save(params({"path":spec.code}),{"sha":previous.sha,"message":"Update middleware code","content":encode(code)},code_updated,code_failed)},should.create_repo?GitHubRepo.create({"name":github.repo,"auto_init":!0},repo_created,repo_failed):(defer_repo.resolve("repo already exists"),do_spec()),$q.all(function(){var _i,_len,_results;for(_results=[],_i=0,_len=defers.length;_len>_i;_i++)d=defers[_i],_results.push(d.promise);return _results}())}})}.call(this),function(){angular.module("slug.services.pretty_print",[]).factory("prettyPrintJson",function(){return function(string){var json;return json=angular.fromJson(string),angular.toJson(json,!0)}}).factory("prettyPrint",function(prettyPrintJson){var extractContentType;return extractContentType=function(contentType){return contentType.split(";")[0]},function(contentType,code){switch(contentType&&extractContentType(contentType)){case"application/json":return prettyPrintJson(code);default:return code}}})}.call(this),function(){var HeuristicsOperator,NumericOperator,Operator,SetOperator,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},__bind=function(fn,me){return function(){return fn.apply(me,arguments)}},__slice=[].slice;Operator=function(){function Operator(key){this.key=key}return Operator.prototype.valueOf=function(){return this.key},Operator.prototype.convert=function(value){return value},Operator.prototype.toJSON=function(){return this.valueOf()},Operator.prototype.toString=function(){return this.valueOf()},Operator}(),NumericOperator=function(_super){function NumericOperator(){return NumericOperator.__super__.constructor.apply(this,arguments)}return __extends(NumericOperator,_super),NumericOperator.prototype.convert=function(value){return parseFloat(value,10)},NumericOperator}(Operator),SetOperator=function(_super){function SetOperator(){return SetOperator.__super__.constructor.apply(this,arguments)}return __extends(SetOperator,_super),SetOperator.prototype.convert=function(value,original){var part,_i,_len,_ref;for(null==original&&(original=[]),_ref=value.split(/,\s*/),_i=0,_len=_ref.length;_len>_i;_i++)part=_ref[_i],original.push(part);return original},SetOperator}(Operator),HeuristicsOperator=function(){function HeuristicsOperator(){this.number=new NumericOperator}return HeuristicsOperator.prototype.convert=function(value){var numeric;return numeric=this.number.convert(value),numeric.toString()===value?numeric:value},HeuristicsOperator}(),angular.module("slug.search",["slug.directives.token_input","slug.directives.search","slug.utils"]).factory("FilterBar",function(Token){var FilterBar;return FilterBar=function(){function FilterBar(){this.type="basic",this.tokens=[]}var DOT;return DOT=/\./,FilterBar.prototype.use=function(filter){var token,_i,_len,_ref,_results;for(this.reset(),_ref=filter.tokens,_results=[],_i=0,_len=_ref.length;_len>_i;_i++)token=_ref[_i],_results.push(this.tokens.push(new Token(token)));return _results},FilterBar.prototype.operator=function(token){var op;switch(token.op){case"=":case"==":return null}return(op=function(){switch(token.op){case">":return"$gt";case">=":return"$gte";case"<":return"$lt";case"<=":return"$lte"}}())?new NumericOperator(op):(op||(op=function(){switch(token.op){case"@":return"$in";case"|":return"$all"}}()),op?new SetOperator(op):op)},FilterBar.prototype.reset=function(){return this.tokens.splice(0,this.tokens.length)},FilterBar.prototype.query=function(){var groups,heuristics,leafs,op,part,partial,partial_path,parts,path,paths,prev,query,root,token,tokens,_i,_j,_k,_len,_len1,_len2;for(query={},tokens=_(this.tokens).filter(function(t){return t.active}),groups=_(tokens).groupBy(function(t){return t.key}),paths=_(groups).keys().sort(),heuristics=new HeuristicsOperator,_i=0,_len=paths.length;_len>_i;_i++)for(path=paths[_i],parts=path.split(DOT),root=query,partial_path=[],_j=0,_len1=parts.length;_len1>_j;_j++)if(part=parts[_j],partial_path.push(part),partial=partial_path.join("."),prev=root,root=root[part]||(root[part]={}),leafs=groups[partial])for(_k=0,_len2=leafs.length;_len2>_k;_k++)token=leafs[_k],(op=this.operator(token))?root[op]=op.convert(token.value,root[op]):prev[part]=heuristics.convert(token.value);return query},FilterBar}()}).factory("TokenHeuristics",function(Token){var TokenHeuristics;return TokenHeuristics=function(){function TokenHeuristics(collection){this.collection=collection}return TokenHeuristics.prototype.singular=function(){var properties;return properties=1<=arguments.length?__slice.call(arguments,0):[],this._singular=properties},TokenHeuristics.prototype.singularProperties=function(){var conditions,key,path,piece,resource,value,_i,_j,_len,_len1,_ref;for(resource=_.isArray(this.collection)?this.collection[0]:this.collection,conditions=[],_ref=this._singular,_i=0,_len=_ref.length;_len>_i;_i++){for(key=_ref[_i],path=key.split("."),value=resource,_j=0,_len1=path.length;_len1>_j;_j++)piece=path[_j],value=null!=value?value[piece]:void 0;value&&conditions.push({"key":key,"op":"=","value":value})}return conditions},TokenHeuristics.prototype.collectionProperties=function(){var all,common_keys,key,keys,match,object_keys,primitive_keys,reference,resource,values,_i,_len,_ref,_results;for(all=_.chain(this.collection),keys=function(){var _i,_len,_ref,_results;for(_ref=this.collection,_results=[],_i=0,_len=_ref.length;_len>_i;_i++)resource=_ref[_i],_results.push(_.keys(resource));return _results}.call(this),common_keys=_.intersection.apply(_,keys),common_keys=_(common_keys).filter(function(key){return!key.match(/^(\$|_)/)}),object_keys=_(common_keys).filter(function(key){return all.pluck(key).all(_.isObject).value()}),primitive_keys=(_ref=_(common_keys)).without.apply(_ref,object_keys),_results=[],_i=0,_len=primitive_keys.length;_len>_i;_i++)key=primitive_keys[_i],values=all.pluck(key).value(),reference=_.first(values),match=_(values).all(function(value){return value===reference}),_results.push(reference&&match?{"key":key,"op":"=","value":reference}:void 0);return _results},TokenHeuristics.prototype.suggestions=function(){var token,_i,_len,_ref,_results;for(_ref=this.compare(),_results=[],_i=0,_len=_ref.length;_len>_i;_i++)token=_ref[_i],_.isEmpty(token)||(token.suggestion=!0,_results.push(new Token(token)));return _results},TokenHeuristics.prototype.compare=function(){return!_.isArray(this.collection)||this.collection.length<=1?this.singularProperties():this.collectionProperties()},TokenHeuristics}()}).factory("Search",function(FilterBar,$timeout,animationFrame,jsonify){var Search;return Search=function(){function Search(resource,scope){this.resource=resource,this.tokens=__bind(this.tokens,this),this.ticker=__bind(this.ticker,this),this.stop_refresh=__bind(this.stop_refresh,this),this.append=__bind(this.append,this),this.prepend=__bind(this.prepend,this),this.replace=__bind(this.replace,this),this.last_id=__bind(this.last_id,this),this["do"]=__bind(this["do"],this),this.last_updated=__bind(this.last_updated,this),this.infinite=__bind(this.infinite,this),this.filter=new FilterBar,null!=scope&&scope.$on("search",this["do"]),null!=scope&&scope.$on("$destroy",this.stop_refresh),this.reversed=!0,this["do"]()}var CHECK_FOR_NEW_MS;return CHECK_FOR_NEW_MS=1e3,Search.prototype.infinite=function(){return!this.loading&&this.results.length<this.count},Search.prototype.last_updated=function(){return this.last_update?new Date-this.last_update:CHECK_FOR_NEW_MS},Search.prototype.wasChanged=function(){return!angular.equals(this.query,this.filter.query())},Search.prototype["do"]=function(){return this.query=this.filter.query(),this.json=jsonify(this.query),this.count=null,this.results=[],this.load({"query":this.query},this.replace)},Search.prototype.last_id=function(func){return func||(func=this.reversed?"min":"max"),_(this.results)[func](function(result){return result._id})._id},Search.prototype.canLoadMore=function(){return this.load_more&&this.results.length<this.count},Search.prototype.reverse=function(){return this.reversed=!this.reversed,this.load({"query":this.query},this.replace)},Search.prototype.more=function(){return this.load_more=!1,this.loading_more=!0,this.load({"query":this.query,"last_id":this.last_id()},this.append)},Search.prototype.refresh=function(){return this.load({"query":this.query,"last_id":this.last_id("max"),"reversed":!1},this.prepend)},Search.prototype.noResults=function(){var _ref;return this.query&&!this.loading&&0===(null!=(_ref=this.results)?_ref.length:void 0)},Search.prototype.load=function(params,callback){return this.stop_refresh(),params.query=jsonify(params.query),this.loading=!0,null==params.reversed||params.reversed?this.reversed&&(params.reversed=this.reversed):delete params.reversed,this.has_more=!1,this.resource.count(params,function(_this){return function(results){return _this.count||(_this.count=results.document_count)}}(this)),this.resource.search(params,function(_this){return function(results){return _this.loading=!1,_this.loading_more=!1,_this.last_update=new Date,"function"==typeof callback&&callback(results),_this.stop_tick=_this.ticker(params)}}(this))},Search.prototype.replace=function(results){return this.results=results},Search.prototype.prepend=function(results){var result,_i,_len,_results;for(_results=[],_i=0,_len=results.length;_len>_i;_i++)result=results[_i],_results.push(this.results.unshift(result));return _results},Search.prototype.append=function(results){var result,_i,_len,_results;for(_results=[],_i=0,_len=results.length;_len>_i;_i++)result=results[_i],_results.push(this.results.push(result));return _results},Search.prototype.stop_refresh=function(){return"function"==typeof this.stop_tick&&this.stop_tick(),$timeout.cancel(this.last_timer)},Search.prototype.ticker=function(params){var enabled,tick;return enabled=!0,tick=function(_this){return function(){return params.last_id=_this.last_id("max"),_this.resource.count(params,function(count){return _this.has_more=count.document_count,enabled?animationFrame.withFallback(function(){return _this.last_timer=$timeout(tick,CHECK_FOR_NEW_MS)}):void 0})}}(this),this.reversed&&tick(),function(){return enabled=!1}},Search.prototype.tokens=function(){return this.filter.tokens},Search.prototype.remove=function(results){var original,removed,_ref;return results=_.isArray(results)?results:[results],original=this.results.length,this.results=(_ref=_(this.results)).without.apply(_ref,results),removed=original-this.results.length,this.count-=removed},Search.prototype.use=function(filter){return this.stop_refresh(),this.filter.use(filter),this.using_filter=filter,this["do"]()},Search.prototype.clear=function(){return this.stop_refresh(),this.filter.reset(),this.using_filter=null,this["do"]()},Search}()})}.call(this);
